<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>一致性哈希与虚拟节点</title>
      <link href="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/"/>
      <url>/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<p>介绍 <strong>一致性哈希</strong>与<strong>虚拟节点</strong>是怎样处理分布式数据管理的。</p><h4 id="一致性哈希"><a class="markdownIt-Anchor" href="#一致性哈希"></a> 一致性哈希</h4><h5 id="概念介绍"><a class="markdownIt-Anchor" href="#概念介绍"></a> 概念介绍</h5><p><strong>传统哈希</strong>对节点和数据的映射当集群中节点数量变化时，会出现需要迁移大量数据的问题。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/6db4c123a50921c292c4ef85b98f01f3.png" alt="截图"></p><p>一致性哈希通过将<strong>节点</strong>与<strong>数据</strong>映射到一个数据空间在逻辑上首尾相连的<strong>哈希环</strong>上，可以解决采用传统哈希函数来进行数据分布式管理时，对集群扩容和缩容时，可能会出现需要<strong>迁移大量数据</strong>而采用的一种特殊哈希算法。</p><p>在哈希环上的数据沿着一个统一的方向去寻找第一个遇到的节点，即为该数据的存储节点。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/960b4f5bfc7247a7aa2849de9798aead.png" alt="截图"></p><p>当节点变化时，至多需要一个节点上的数据进行迁移</p><ul><li><p>增加</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/5d50af1d1c36a06b52e4171b5a40452a.png" alt="截图"></p></li><li><p>减少：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/c824f305af3a2431322d07388859969f.png" alt="截图"></p></li></ul><h5 id="存在的问题"><a class="markdownIt-Anchor" href="#存在的问题"></a> 存在的问题</h5><p>哈希环的数据空间很大: 0-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{32}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，而实际的部署节点相比太过稀疏，导致数据对节点的分配不均：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/297b8d1e13a534cd4725fb4b78324054.png" alt="截图"></p><p>带来的问题是，热点节点的负载会比较高，当热点节点宕机时，或者扩容和缩容时，热点节点的后继节点会突然承受较大压力，从而容易引起雪崩式反应。</p><h4 id="虚拟节点"><a class="markdownIt-Anchor" href="#虚拟节点"></a> 虚拟节点</h4><p>通过虚拟节点提高节点均匀度。</p><ul><li>每个物理节点会被分化为很多个虚拟节点</li><li>对所有物理节点下的虚拟节点进行到哈希环上的映射，确保分配均匀</li><li>数据先找到的是虚拟节点，然后再去找到真实物理节点</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/06/redis/%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E4%B8%8E%E8%99%9A%E6%8B%9F%E8%8A%82%E7%82%B9/ad77d7fcc911bb082f2aacca8ee95a7a.png" alt="截图"></p><p>虚拟节点的多少还可以根据物理节点的硬件配置来决定。</p><p>节点访问均匀度的提升对扩容和缩容这样节点规模变化的场景下的系统稳定性的提升有一定作用。</p>]]></content>
      
      
      <categories>
          
          <category> learn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一致性哈希 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MurmurHash2算法简介</title>
      <link href="/2025/01/05/redis/MurmurHash2%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B/"/>
      <url>/2025/01/05/redis/MurmurHash2%E7%AE%97%E6%B3%95%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<p>介绍 MurmurHash2 算法的特点，优势，缺点，应用场景，基本实现，MurmurHash2 是一种哈希算法，高效，非加密。</p><h4 id="特点"><a class="markdownIt-Anchor" href="#特点"></a> 特点</h4><ol><li><strong>非加密</strong>：<ul><li>不适用于密码学。</li><li>设计目标不为 高碰撞性与安全性。</li></ul></li><li><strong>高性能：</strong><ul><li>使用位运算，混合函数实现，计算速度快。</li></ul></li><li><strong>分布均匀：</strong><ul><li>体现输入中各个位的影响，hash 值分布均匀。</li></ul></li></ol><br><h4 id="算法思想"><a class="markdownIt-Anchor" href="#算法思想"></a> 算法思想</h4><ol><li><strong>分块处理：</strong><ul><li>把输入按照每 32/64 位分为一组处理。</li></ul></li><li><strong>混合操作：</strong><ul><li>对每个分块进行混合计算，包括与常数相乘，移位异或，与当前结果混合。</li></ul></li><li><strong>最终混合：</strong><ul><li>将剩下的不足 4/8 字节的数组混合进结果，然后在对结果做混合，确保所有输入位都对结果有影响。</li></ul></li></ol><p><strong>伪代码：</strong></p><p>以 32 位版本的 MurmurHash2 为例，伪代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">uint m(const void *key,int len)&#123;<br>  uint seed = gen();<br>  const uint m;<br>  const int r;<br>  uint h = len ^ seed;<br>  <br>  const uchar *data = (const uchar *)key;<br>  while(len&gt;=4)&#123;<br>    uint k = *(uint *)data;<br>    <br>    // mix m r h<br>    /*<br>    ....<br>    */<br>    <br>    data += 4;<br>    len -= 4;<br>  &#125;<br>  // rest bytes<br>  /*<br>  swich(len)<br>  */<br>  <br>  // final mix m h<br>  /*<br>  ...<br>  */<br>  return h;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>redis 中的实现：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">/* MurmurHash2, by Austin Appleby<br> * Note - This code makes a few assumptions about how your machine behaves -<br> * 1. We can read a 4-byte value from any address without crashing<br> * 2. sizeof(int) == 4<br> *<br> * And it has a few limitations -<br> *<br> * 1. It will not work incrementally. liyazzi: 也就是key需要一次性完整知道，不适合动态数据流，因为每一次的混合计算都依赖于前面的数据，然后最后的混合依赖于整个数据<br> * 2. It will not produce the same results on little-endian and big-endian 影响跨平台性<br> *    machines.<br> */<br>unsigned int dictGenHashFunction(const void *key, int len) &#123;<br>    /* &#x27;m&#x27; and &#x27;r&#x27; are mixing constants generated offline.<br>     They&#x27;re not really &#x27;magic&#x27;, they just happen to work well.  */<br>    uint32_t seed = dict_hash_function_seed;<br>    const uint32_t m = 0x5bd1e995;<br>    const int r = 24;<br><br>    /* Initialize the hash to a &#x27;random&#x27; value */<br>    uint32_t h = seed ^ len;<br><br>    /* Mix 4 bytes at a time into the hash */<br>    const unsigned char *data = (const unsigned char *)key;<br><br>    while(len &gt;= 4) &#123;<br>        uint32_t k = *(uint32_t*)data;<br><br>        k *= m;<br>        k ^= k &gt;&gt; r;<br>        k *= m;<br><br>        h *= m;<br>        h ^= k;<br><br>        data += 4;<br>        len -= 4;<br>    &#125;<br><br>    /* Handle the last few bytes of the input array  */<br>    switch(len) &#123;<br>    case 3: h ^= data[2] &lt;&lt; 16;<br>    case 2: h ^= data[1] &lt;&lt; 8;<br>    case 1: h ^= data[0]; h *= m;<br>    &#125;;<br><br>    /* Do a few final mixes of the hash to ensure the last few<br>     * bytes are well-incorporated. */<br>    h ^= h &gt;&gt; 13;<br>    h *= m;<br>    h ^= h &gt;&gt; 15;<br><br>    return (unsigned int)h;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>哈希函数中大多混淆操作选用 <code>^</code> 的原因：</p><ul><li>异或操作能混合数据的各个位的特征，异或操作拥有自反性</li><li>消除偏置：避免简单的加法与乘法带来的累计偏置</li><li>性能高效：CPU级别运算，位运算通常速度较快</li></ul></blockquote><h4 id="redis中的使用"><a class="markdownIt-Anchor" href="#redis中的使用"></a> Redis中的使用</h4><p>在 redis 中，MurmurHash2 被用作默认哈希函数实现，主要用于：</p><ol><li><strong>计算哈希表的 key 索引</strong></li><li><strong>计算一致性哈希中虚拟节点的位置</strong></li></ol><p>选择 MurmurHash2 的原因：</p><ul><li>快速：适合 redis 高性能的需求</li><li>均匀：减少哈希冲突</li><li>简单：实现简单</li></ul><h4 id="缺点"><a class="markdownIt-Anchor" href="#缺点"></a> 缺点</h4><p>MurmurHash2 在某些情况下可能会出现哈希碰撞率略高的问题。</p><blockquote><p>Hash functions can be vulnerable to collision attacks, where a user can choose input data in such a way so as to intentionally cause hash collisions. Jean-Philippe Aumasson and Daniel J. Bernstein were able to show that even implementations of MurmurHash using a randomized seed are vulnerable to so-called HashDoS attacks.[51] With the use of differential cryptanalysis, they were able to generate inputs that would lead to a hash collision. The authors of the attack recommend using their own SipHash instead.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> learn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Reids基础数据结构（上）</title>
      <link href="/2025/01/04/redis/Redis%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
      <url>/2025/01/04/redis/Redis%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>介绍 redis 中多种基础的数据结构, 包括 sds, adlist, dict, skipList, intset, ziplist, redisObject.</p><h3 id="sds"><a class="markdownIt-Anchor" href="#sds"></a> sds</h3><p>Redis 使用 sds 来处理字符串，用来解决 c 语言中传统字符串的一些限制问题，比如 二进制安全，避免内存频繁重分配，防止字符数组访问越界，实现O(1) 复杂度获取字符串长度，减少频繁内存分配产生的内存碎片。</p><p>Redis 使用 sds 来存储 key，用来作为 AOF 的缓冲区和与客户端通信中的缓冲区，用来实现日志系统的消息，构建协议（RESP）。</p><h4 id="数据结构实现"><a class="markdownIt-Anchor" href="#数据结构实现"></a> 数据结构实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">// simple dynamic string header<br>struct sdshdr &#123;<br>    <br>    // buf 中已占用空间的长度<br>    // 通过 len 来确定有效数据范围，保证 &#x27;\0&#x27; 也可以作为数据部分，也就是二进制安全<br>    int len;<br><br>    // buf 中剩余可用空间的长度<br>    int free;<br><br>    // buf.size = len + free + 1<br>    char buf[];<br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="避免内存频繁重分配的方法"><a class="markdownIt-Anchor" href="#避免内存频繁重分配的方法"></a> 避免内存频繁重分配的方法</h4><p>当需要修改字符串长度的操作时，传统的c函数在n次操作下基本会有n次内存重分配操作，sds 通过使用 free 字段和空间预分配、未使用空间惰性删除来避免频繁的内存重分配，优化为至多n次内存重分配。</p><h5 id="空间与分配"><a class="markdownIt-Anchor" href="#空间与分配"></a> 空间与分配</h5><p>策略伪代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">addlen &lt;= nowfree return;<br>oldSds =  getSdsPrt(s);<br>len = oldSds-&gt;len;<br>newlen = addlen + len;<br>if(newlen &lt; PRE) newlen *= 2;<br>else newlen += PRE<br>newSds = zrealloc(oldSds, newlen + 1 + size(sds))<br>newSds-&gt;free = newlen - len;<br></code></pre></td></tr></table></figure><p>策略：当需要扩展 buf 部分时，根据当前 <code>len</code> 与需求大小<code>addlen</code> 的和来决定除了要分配满足 <code>addlen</code> 大小的空间还将要多预分配多少空间大小以便在下次还需要扩展空间时可以适当地命中该次多预分配的空间，从而减少内存重分配次数。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">/*<br> *  T = O(N)<br> *  1. 如果 oldlen+ addlen &lt; 1MB 则 newMaxLen =  2 (oldlen + addlen); newFree = newmaxlen - oldlen; 实际上的预扩充操作是<br> *  在caller 调用后使得： sds 在满足 addlen 后，使得 newfree 的大小与 caller 调用后使用掉 addlen这部分空间后 sds 的 len 的大小一样<br> *  2. oldlen+ addlen &gt;= 1MB, 则 newMaxLen = oldlen + addlen + 1MB, caller 使用 addlen 这部分后的 free 固定= 1MB<br> *  总结：<br> *  1. 在当前 sds buf 大小较小时，每次扩充操作使得 下一次在需要扩充的 addlen 阈值（也就是 newfree）为 = oldlen + addlen.<br> *  可以发现 newfree 是根据 sds 的上一次字符使用量 与 该次所需要的addlen 动态生成的，<br> *  如果对 sds 扩充操作需求是较为 连续平均的，将会大大降低整个过程中 引发的内存扩充重分配次数<br> *  2. 在 sds buf 本身已经较大时， 直接使得 newfree = 1MB<br> *  这种预留分配策略使得以前的 n次 concat 操作的 n 次扩容优化为 最多 n 次<br> */<br>sds sdsMakeRoomFor(sds s, size_t addlen) &#123;<br><br>    struct sdshdr *sh, *newsh;<br><br>    // 获取 s 目前 free<br>    size_t free = sdsavail(s);<br><br>    size_t len, newlen;<br><br>    // s 目前的空余空间已经足够，无须再进行扩展，直接返回<br>    if (free &gt;= addlen) return s;<br><br>    // 获取 s 目前已占用空间的长度<br>    len = sdslen(s);<br>    // s 其实是一个字符指针，指向 buf 的起始地址，减去 sdshdr 的大小其实就是指向该结构体起始地址的指针<br>    // 用这种操作来获取给定 buf 所属的结构体指针，很巧妙<br>    sh = (void*) (s-(sizeof(struct sdshdr)));<br><br>    // newlen 为分配后 len 的最小值<br>    newlen = (len+addlen);<br><br>    // 根据新长度，为 s 分配新空间所需的大小<br>    if (newlen &lt; SDS_MAX_PREALLOC)<br>        // 如果新长度小于 SDS_MAX_PREALLOC <br>        // 那么为它分配两倍于所需长度的空间<br>        newlen *= 2;<br>    else<br>        // 否则，分配长度为目前长度加上 SDS_MAX_PREALLOC<br>        newlen += SDS_MAX_PREALLOC;<br>    // T = O(N)<br>    newsh = zrealloc(sh, sizeof(struct sdshdr)+newlen+1);<br><br>    // 内存不足，分配失败，返回<br>    if (newsh == NULL) return NULL;<br><br>    // 更新 sds 的空余长度<br>    newsh-&gt;free = newlen - len;<br><br>    // 返回 sds<br>    return newsh-&gt;buf;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="空间惰性释放"><a class="markdownIt-Anchor" href="#空间惰性释放"></a> 空间惰性释放</h5><p>当需要裁剪 sds 内容时，redis 不会立马释放掉当前不需要的空间，而是通过 <code>len</code> 与 <code>free</code> 字段来实现”逻辑“删除。</p><p><strong>trim</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">sds sdstrim(sds s, const char *cset) &#123;<br>    struct sdshdr *sh = (void*) (s-(sizeof(struct sdshdr)));<br>    char *start, *end, *sp, *ep;<br>    size_t len;<br><br>    sp = start = s;<br>    ep = end = s+sdslen(s)-1;<br><br>    // 双指针寻找左右界限，都是一直移动直到遇到不属于 cset 中的第一个字符<br>    while(sp &lt;= end &amp;&amp; strchr(cset, *sp)) sp++;<br>    while(ep &gt; start &amp;&amp; strchr(cset, *ep)) ep--;<br><br>    len = (sp &gt; ep) ? 0 : ((ep-sp)+1);<br>    <br>    if (sh-&gt;buf != sp) memmove(sh-&gt;buf, sp, len);<br>    <br>    sh-&gt;buf[len] = &#x27;\0&#x27;;<br><br>    sh-&gt;free = sh-&gt;free+(sh-&gt;len-len);<br>    sh-&gt;len = len;<br><br>    return s;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>clear</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">void sdsclear(sds s) &#123;<br><br>    struct sdshdr *sh = (void*) (s-(sizeof(struct sdshdr)));<br><br>    sh-&gt;free += sh-&gt;len;<br>    sh-&gt;len = 0;<br>    <br>    sh-&gt;buf[0] = &#x27;\0&#x27;;<br>&#125;<br></code></pre></td></tr></table></figure><br><h3 id="adlist"><a class="markdownIt-Anchor" href="#adlist"></a> adlist</h3><p>adlist( abstract doubly linked list) 是redis的抽象双端链表，特点 双端，无环，有表头和表尾指针，节点支持多种类型数据。</p><p>adlist 作为基础数据结构，用于 Pub/Sub 订阅模型列表，等待队列，和作为基础数据结构。</p><h4 id="数据结构实现-2"><a class="markdownIt-Anchor" href="#数据结构实现-2"></a> 数据结构实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">typedef struct listNode &#123;<br><br>    // 前置节点<br>    struct listNode *prev;<br><br>    // 后置节点<br>    struct listNode *next;<br><br>    // 节点的值，注意类型是 void *，可以存储任意类型数据的指针<br>    void *value;<br><br>&#125; listNode;<br><br>typedef struct list &#123;<br><br>    // 表头节点<br>    listNode *head;<br><br>    // 表尾节点<br>    listNode *tail;<br><br>    // 节点值复制函数<br>    void *(*dup)(void *ptr);<br><br>    // 节点值释放函数<br>    void (*free)(void *ptr);<br><br>    // 节点值对比函数<br>    int (*match)(void *ptr, void *key);<br><br>    // 链表所包含的节点数量<br>    unsigned long len;<br><br>&#125; list;<br></code></pre></td></tr></table></figure><br><h3 id="dict"><a class="markdownIt-Anchor" href="#dict"></a> dict</h3><p>dict，字典是redis的核心数据结构，用来快速查找元素，redis 采用链表来解决哈希冲突，哈希算法使用 MurmurHash2。</p><h4 id="数据结构实现-3"><a class="markdownIt-Anchor" href="#数据结构实现-3"></a> 数据结构实现</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">typedef struct dictEntry &#123;<br>    <br>    // 键<br>    void *key;<br><br>    // 值<br>    union &#123;<br>        void *val;<br>        uint64_t u64;<br>        int64_t s64;<br>    &#125; v;<br><br>    // 指向下个哈希表节点，形成链表<br>    struct dictEntry *next;<br><br>&#125; dictEntry;<br><br><br>/*<br> * 字典类型特定函数<br> */<br>typedef struct dictType &#123;<br><br>    // 计算哈希值的函数<br>    unsigned int (*hashFunction)(const void *key);<br><br>    // 复制键的函数<br>    void *(*keyDup)(void *privdata, const void *key);<br><br>    // 复制值的函数<br>    void *(*valDup)(void *privdata, const void *obj);<br><br>    // 对比键的函数<br>    int (*keyCompare)(void *privdata, const void *key1, const void *key2);<br><br>    // 销毁键的函数<br>    void (*keyDestructor)(void *privdata, void *key);<br>    <br>    // 销毁值的函数<br>    void (*valDestructor)(void *privdata, void *obj);<br><br>&#125; dictType;<br><br><br>/* This is our hash table structure. Every dictionary has two of this as we<br> * implement incremental rehashing, for the old to the new table. */<br>/*<br> * 哈希表<br> *<br> * 每个字典都使用两个哈希表，从而实现渐进式 rehash 。<br> */<br>typedef struct dictht &#123;<br>    <br>    // 哈希表数组<br>    dictEntry **table;<br><br>    // 哈希表大小<br>    unsigned long size;<br>    <br>    // 哈希表大小掩码，用于计算索引值<br>    // 总是等于 size - 1<br>    unsigned long sizemask;<br><br>    // 该哈希表已有节点的数量<br>    unsigned long used;<br><br>&#125; dictht;<br><br>/*<br> * 字典<br> * 定义一组操作(dictType)与数据<br> */<br>typedef struct dict &#123;<br><br>    // 类型特定函数<br>    dictType *type;<br><br>    // 私有数据<br>    void *privdata;<br><br>    // 哈希表，注意有两个哈希表，用以 rehash<br>    dictht ht[2];<br><br>    // rehash 索引<br>    // 当 rehash 不在进行时，值为 -1<br>    int rehashidx; /* rehashing not in progress if rehashidx == -1 */<br><br>    // 目前正在运行的安全迭代器的数量<br>    int iterators; /* number of iterators currently running */<br><br>&#125; dict;<br></code></pre></td></tr></table></figure><br><h4 id="rehash"><a class="markdownIt-Anchor" href="#rehash"></a> rehash</h4><p>目的：为了维持dict中负载因子在一个合理的范围，以便不影响数据库性能，对dict的 hash table 大小进行调整，然后对现有的 k-v 对进行 rehash 到新的 hash table 上。</p><p><strong>rehash 的时机</strong>：</p><ol><li><p>当前 负载因子 &gt;=1 并且没有进行 AOF RDB 的阻塞操作</p></li><li><p>如果当前阻塞，负载因子 &gt;= 5 也会强制进行rehash</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">static int _dictExpandIfNeeded(dict *d)<br>&#123;<br>    /* Incremental rehashing already in progress. Return. */<br>    // 渐进式 rehash 已经在进行了，直接返回<br>    if (dictIsRehashing(d)) return DICT_OK;<br><br>    /* If the hash table is empty expand it to the initial size. */<br>    // 如果字典（的 0 号哈希表）为空，那么创建并返回初始化大小的 0 号哈希表<br>    // T = O(1)<br>    if (d-&gt;ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);<br><br>    /* If we reached the 1:1 ratio, and we are allowed to resize the hash<br>     * table (global setting) or we should avoid it but the ratio between<br>     * elements/buckets is over the &quot;safe&quot; threshold, we resize doubling<br>     * the number of buckets. */<br>    // 一下两个条件之一为真时，对字典进行扩展<br>    // 1）字典已使用节点数和字典大小之间的比率接近 1：1<br>    //    并且 dict_can_resize 为真<br>    // 2）已使用节点数和字典大小之间的比率超过 dict_force_resize_ratio<br>    if (d-&gt;ht[0].used &gt;= d-&gt;ht[0].size &amp;&amp;<br>        (dict_can_resize ||<br>         d-&gt;ht[0].used/d-&gt;ht[0].size &gt; dict_force_resize_ratio))<br>    &#123;<br>        // 新哈希表的大小至少是目前已使用节点数的两倍<br>        // T = O(N)<br>        return dictExpand(d, d-&gt;ht[0].used*2);<br>    &#125;<br><br>    return DICT_OK;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>关于第二点</strong>：</p><blockquote><p>redis 在进行持久化操作时，使用 fork 子进程来实现，而大多数操作系统采用 COW 来优化子进程的内存使用，在子进程创建时，和父进程拥有相同的内存页，只有当其中一个进程尝试修改内存内容时，操作系统才去先 copy 这部分页面到需要修改的进程空间中，这样避免了在子进程创建时全量 copy 父进程的内存内容，避免了大量不必要的内存开销。所以对于 rehash ，当有 AOF RDB 持久化所创建的子进程时，为了避免一些不必要的 COW 引起的内存开销，rehash 的阈值要求会更严格一些；并且 redish 提供了 <code>dictEnableResize() / dictDisableResize()</code> 来主动控制 rehash 的进行，但需要注意的是当负载因子 &gt;= 5 时，会强制 rehash.</p></blockquote><p><strong>rehash 过程：</strong></p><ol><li>分配新的 hash table -&gt; ht[1], 且新 table 的大小满足：始终是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span>  ，如果是扩容，则是大于等于 ht[0] * 2 的的第一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span>, 若是收缩，则是大于等于 ht[0]/2 的第一个<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span>.</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c_cpp">static unsigned long _dictNextPower(unsigned long size)<br>&#123;<br>    unsigned long i = DICT_HT_INITIAL_SIZE;<br><br>    if (size &gt;= LONG_MAX) return LONG_MAX;<br>    while(1) &#123;<br>        if (i &gt;= size)<br>            return i;<br>        i *= 2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li>渐进式 rehash，逐步迁移数据，分而治之，通常 redis 中 dict 中 k-v 对会非常多，避免一次性迁移导致大量数据的读写会让服务暂停，所以把数据迁移操作分摊在对外部数据的操作之中。每次对 dict 进行增删改查时，除了完成特定的操作外，还会顺带将 <code>rehashidx</code> 所指示的 hash 槽中的所有节点迁移到 ht[1] 中，更新 <code>rehashidx</code>. 需要注意的是，在整个 rehash 过程中，仍然响应受客户端请求，对于查询，则会依次查找 ht[0], ht[1]. 更新与删除类似。对于新增，则只会在 ht[1] 中操作。</li><li>到某一个时间点 <code>rehashidx == ht[0].size</code>，迁移完成，将 <code>rehashidx</code> 设置为 -1，释放 ht[0]的空间，将ht[1] 设置为 ht[0].</li></ol><blockquote><p>rehash 并不是一个由另外的线程或者进程进行的子任务，而是被一个标志位指示：<code>rehashidx != -1</code>，并且不是一个连续不被打断的操作，而是分散于对 dict 的数据操作之中，保证了服务的可用性。</p><p>redis 的主要数据工作模式是基于事件驱动的单线程模型，Linux 上通过 IO多路复用(epoll) 来接受客户端请求。单线程的数据工作模式避免了多线程下的数据竞争，上下文切换和因锁机制导致的性能损失。但后来的版本引入了多线程来使得 网络IO 方面的 处理请求与返回响应被 独立的线程处理，优化了网络 IO 的性能瓶颈。</p></blockquote><br><p>参考：</p><blockquote><ul><li>Redis设计与实现</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> learn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSL 安装及其相关配置</title>
      <link href="/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/"/>
      <url>/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="install"><a class="markdownIt-Anchor" href="#install"></a> install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wsl -l -o<br></code></pre></td></tr></table></figure><p>查看现可下载分发版列表.（最好开代理）</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell">~ wsl <span class="hljs-literal">-l</span> <span class="hljs-literal">-o</span><br>以下是可安装的有效分发的列表。<br>使用 <span class="hljs-string">&#x27;wsl.exe --install &lt;Distr&gt;&#x27;</span> 安装。<br><br>NAME                            FRIENDLY NAME<br>Ubuntu                          Ubuntu<br>Debian                          Debian GNU/Linux<br>kali<span class="hljs-literal">-linux</span>                      Kali Linux Rolling<br>Ubuntu<span class="hljs-literal">-18</span>.<span class="hljs-number">04</span>                    Ubuntu <span class="hljs-number">18.04</span> LTS<br>Ubuntu<span class="hljs-literal">-20</span>.<span class="hljs-number">04</span>                    Ubuntu <span class="hljs-number">20.04</span> LTS<br>Ubuntu<span class="hljs-literal">-22</span>.<span class="hljs-number">04</span>                    Ubuntu <span class="hljs-number">22.04</span> LTS<br>Ubuntu<span class="hljs-literal">-24</span>.<span class="hljs-number">04</span>                    Ubuntu <span class="hljs-number">24.04</span> LTS<br>OracleLinux_7_9                 Oracle Linux <span class="hljs-number">7.9</span><br>OracleLinux_8_7                 Oracle Linux <span class="hljs-number">8.7</span><br>OracleLinux_9_1                 Oracle Linux <span class="hljs-number">9.1</span><br>openS<span class="hljs-built_in">USE-Leap</span><span class="hljs-literal">-15</span>.<span class="hljs-number">6</span>              openSUSE Leap <span class="hljs-number">15.6</span><br>S<span class="hljs-built_in">USE-Linux</span><span class="hljs-literal">-Enterprise-15-SP5</span>    SUSE Linux Enterprise <span class="hljs-number">15</span> SP5<br>S<span class="hljs-built_in">USE-Linux</span><span class="hljs-literal">-Enterprise-15-SP6</span>    SUSE Linux Enterprise <span class="hljs-number">15</span> SP6<br>openS<span class="hljs-built_in">USE-Tumbleweed</span>             openSUSE Tumbleweed<br></code></pre></td></tr></table></figure><h4 id="移动存储文件"><a class="markdownIt-Anchor" href="#移动存储文件"></a> 移动存储文件</h4><p><code>wsl --install &lt;distr-name&gt;</code> 将会 -&gt; <strong>dir</strong>: <code>C:\Users\&lt;username&gt;\AppData\Local\Packages\&lt;ditr-name&gt;</code>，wsl 的虚拟存储文件位于 <code>dir/LocalState</code>.</p><p>移动该<code>ext4.vhdx</code> :</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wsl <span class="hljs-literal">--manage</span> &lt;distr<span class="hljs-literal">-name</span>&gt; <span class="hljs-literal">--move</span> &lt;/path/<span class="hljs-built_in">dir</span>&gt;<br></code></pre></td></tr></table></figure><h4 id="更改-distro-name"><a class="markdownIt-Anchor" href="#更改-distro-name"></a> 更改 distro-name</h4><p>实际也更改了<code>ext4.vhdx</code> 的位置.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">~ wsl <span class="hljs-literal">-l</span> <span class="hljs-literal">-v</span><br>  NAME            STATE           VERSION<br>* Ubuntu<span class="hljs-literal">-18</span>.<span class="hljs-number">04</span>    Running         <span class="hljs-number">2</span><br>  docker          Running         <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>目前好像只能通过导出再导入 (真麻烦 )-: 😓</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wsl <span class="hljs-literal">--export</span> &lt;distr<span class="hljs-literal">-name</span>&gt; &lt;/path/backup.tar&gt;<br>wsl <span class="hljs-literal">--import</span> &lt;<span class="hljs-built_in">new-distr</span><span class="hljs-literal">-name</span>&gt; &lt;/path/to<span class="hljs-literal">-vhdx-dir</span>&gt; &lt;/path/backup.tar&gt;<br></code></pre></td></tr></table></figure><h2 id="使用新式-windows-终端-访问wsl"><a class="markdownIt-Anchor" href="#使用新式-windows-终端-访问wsl"></a> 使用新式 Windows 终端 访问wsl</h2><ul><li>启动命令行</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># 启动时 cd 到 home<br>C:\Windows\system32\wsl.exe -d &lt;distr-name&gt; --cd ~<br></code></pre></td></tr></table></figure><ul><li>图标：<code>https://assets.ubuntu.com/v1/49a1a858-favicon-32x32.png</code></li><li>Ubuntu终端经典外观配色</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/8d8c6cd6db88c543cce7b682c3d4c027.png" alt="screen-capture"></p><h2 id="网络"><a class="markdownIt-Anchor" href="#网络"></a> 网络</h2><p>wsl 默认网络模式为 <code>NAT</code>，不能直接使用宿主机的 localhost 代理，多个distrobution共享同一个网络栈（意味着有相同的ip 😓 )-:</p><p>什么是 <code>NAT</code>: 通过对 IP 数据包中源 IP / 端口，目的 IP / 端口修改，使得在同一个私有子网中的主机通过一个共有 IP 对外访问的网络技术。</p><p>几种 NAT 类型</p><p>前三种：<code>映射 IP / port</code> 与 <code>目的 IP / port</code> 无关，前者固定。</p><p>对称NAT：对于每一个不同的 <code>目的 IP / port</code> 其 <code>映射 IP / port</code> 都不同，<strong>动态</strong>生成。</p><table><thead><tr><th>Name</th><th>示例图</th></tr></thead><tbody><tr><td>完全圆锥型NAT（Full cone NAT，也叫NAT1）<br>1. 一旦内部地址（iAddr:iPort）映射到外部地址（eAddr:ePort），所有发自iAddr:iPort的数据包都经由eAddr:ePort向外发送。 <br>2. 任意外部主机都能经由发送数据包给eAddr:ePort到达iAddr:iPort。</td><td><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/f959905884b8f13a8b2db18f420d2c9e.png" alt="截图"></td></tr><tr><td>受限圆锥型NAT（Restricted cone NAT，也叫NAT2） <br>1. 一旦内部地址（iAddr:iPort）映射到外部地址（eAddr:ePort），所有发自iAddr:iPort的数据包都经由eAddr:ePort向外发送。 <br>2. 唯iAddr:iPort曾经发送数据包到外部主机（nAddr:any），外部主机才能经由发送数据包给eAddr:ePort到达iAddr:iPort。（注：any指外部主机源端口不受限制。）</td><td><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/653ac91a75604219cd939402dc3c64dd.png" alt="截图"></td></tr><tr><td>端口受限圆锥型NAT（Port-Restricted cone NAT，也叫NAT3） 类似受限制锥形NAT，但是还有端口限制。 <br>1.  一旦内部地址（iAddr:iPort）映射到外部地址（eAddr:ePort），所有发自iAddr:iPort的数据包都经由eAddr:ePort向外发送。 <br>2. 在受限圆锥型NAT基础上增加了外部主机源端口必须是固定的</td><td><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/ed4537e078f93a31382893730f72077a.png" alt="截图"></td></tr><tr><td>对称NAT（Symmetric NAT，也叫NAT4） <br>1. 每一个来自相同内部IP与端口，到一个特定目的地IP和端口的请求，都映射到一个独特的外部IP和端口。 同一内部IP与端口发到不同的目的地和端口的信息包，都使用不同的映射。 <br>2. 只有曾经收到过内部主机数据的外部主机，才能够把数据包发回。</td><td><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2025/01/02/tools/WSL%20%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/68ccbc65d8d30b41cd6904a1446b7206.png" alt="截图"></td></tr></tbody></table><h3 id="解决多个distr共享同一个ip"><a class="markdownIt-Anchor" href="#解决多个distr共享同一个ip"></a> 解决多个distr共享同一个ip</h3><p>额。。没得解决，至少不能通过现有的配置项解决，所有的 wsl distr 都是共享一个  wsl vm ，本质上处于同一 network namespace，也有一些 “奇淫技巧”可以实现不同ip，但都有一些这样那样的限制，不够通用 --_–</p><h3 id="解决代理问题"><a class="markdownIt-Anchor" href="#解决代理问题"></a> 解决代理问题</h3><blockquote><p>最好关闭wsl的防火墙</p><p>~/.wslconfig</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[wsl2]<br>firewall=false<br></code></pre></td></tr></table></figure></blockquote><p>两种方式：</p><ol><li>通过局域网形式手动设置到宿主机的代理.</li><li>使用 <code>mirror</code>网络模式. （该种方式下宿主机通过 <code>localhost:port</code> 访问 docker 容器 会有些问题，通过 <code>LAN IP</code>  访问是没问题的。）</li></ol><h4 id="mirror"><a class="markdownIt-Anchor" href="#mirror"></a> mirror</h4><h4 id="局域网代理"><a class="markdownIt-Anchor" href="#局域网代理"></a> 局域网代理</h4><ol><li>开启代理软件的局域网访问。</li><li>固定宿主机 wsl 虚拟网卡的 ip （电脑重启后会失效 😓）</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 先看看现在的 ip 与 mask</span><br>ipconfig<br><span class="hljs-comment"># PS 下管理员</span><br>netsh interface ip <span class="hljs-built_in">set</span> address name=<span class="hljs-string">&quot;&lt;wsl-vEthernet-name&gt;&quot;</span> <span class="hljs-keyword">static</span> &lt;host<span class="hljs-literal">-ip</span>&gt; &lt;mask&gt;<br></code></pre></td></tr></table></figure><ol start="3"><li>固定 wsl 实例 ip （方便后面访问 wsl 内服务）</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> vim /etc/netplan/01-netcfg.yaml<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">network:</span><br> <span class="hljs-attr">version:</span> <span class="hljs-number">2</span><br> <span class="hljs-attr">ethernets:</span><br>   <span class="hljs-attr">eth0:</span><br>     <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">no</span><br>     <span class="hljs-attr">addresses:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">&lt;ip&gt;/N</span>  <span class="hljs-comment"># 静态 IP 地址和子网掩码，可以参照 ip addr shouw eth0</span><br>     <span class="hljs-attr">gateway4:</span> <span class="hljs-string">&lt;host-ip&gt;</span> <span class="hljs-comment"># 宿主机固定的 ip</span><br>     <span class="hljs-attr">nameservers:</span><br>       <span class="hljs-attr">addresses:</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>           <span class="hljs-comment"># 首选 DNS</span><br>         <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span>           <span class="hljs-comment"># 备用 DNS</span><br></code></pre></td></tr></table></figure><p>应用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> netplan apply<br></code></pre></td></tr></table></figure><ol start="4"><li>为 apt，curl，docker，git 设置代理</li></ol><p>使用 zsh 的配置文件中自定义的 环境变量导出脚本代理 apt curl</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-function"><span class="hljs-title">proxy</span></span> () &#123;<br>  host_proxy=&lt;host-ip&gt;:&lt;port&gt;<br>  <span class="hljs-built_in">export</span> ALL_PROXY=<span class="hljs-string">&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>&quot;</span><br>  <span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>&quot;</span><br>  <span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>&quot;</span><br>  <span class="hljs-built_in">export</span> NO_PROXY=localhost,127.0.0.1<br>  git config --global http.proxy <span class="hljs-string">&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>&quot;</span><br>  git config --global https.proxy <span class="hljs-string">&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>&quot;</span><br>  <br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;Acquire::http::Proxy \&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>\&quot;;\nAcquire::https::Proxy \&quot;http://<span class="hljs-variable">$&#123;host_proxy&#125;</span>\&quot;;&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span>  /etc/apt/apt.conf.d/apt-proxy.conf &gt; /dev/null<br>&#125;<br><br><span class="hljs-comment"># 取消代理</span><br><span class="hljs-function"><span class="hljs-title">unproxy</span></span> () &#123;<br>  <span class="hljs-built_in">unset</span> ALL_PROXY<br>  <span class="hljs-built_in">unset</span> HTTP_PROXY<br>  <span class="hljs-built_in">unset</span> HTTPS_PROXY<br>  git config --global --<span class="hljs-built_in">unset</span> http.proxy<br>  git config --global --<span class="hljs-built_in">unset</span> https.proxy<br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span>  /etc/apt/apt.conf.d/apt-proxy.conf &gt; /dev/null<br>&#125;<br></code></pre></td></tr></table></figure><p>为 docker 设置代理</p><p>For docker daemon (to access images stored on Docker Hub and other registries, and to reach other nodes in a Docker swarm):</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> vim /etc/docker/daemon.json<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#123;<br>  &quot;proxies&quot;: &#123;<br>    &quot;http-proxy&quot;: &quot;&lt;host-proxy&gt;&quot;,<br>    &quot;https-proxy&quot;: &quot;&lt;host-proxy&gt;&quot;,<br>    &quot;no-proxy&quot;: &quot;*.test.example.com,.example.org,127.0.0.0/8&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> systemctl restart docker<br></code></pre></td></tr></table></figure><p>For builds and containers</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim ~/.docker/config.json<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">&#123;<br> &quot;proxies&quot;: &#123;<br>   &quot;default&quot;: &#123;<br>     &quot;httpProxy&quot;: &quot;&lt;host-proxy&gt;&quot;,<br>     &quot;httpsProxy&quot;: &quot;&lt;host-proxy&gt;&quot;,<br>     &quot;noProxy&quot;: &quot;*.test.example.com,.example.org,127.0.0.0/8&quot;<br>   &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>For docker building image,only avaliable during building the image</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker build --build-arg HTTP_PROXY=<span class="hljs-string">&quot;&lt;host-proxy&gt;&quot;</span> .<br></code></pre></td></tr></table></figure><h2 id="使用oh-my-zsh"><a class="markdownIt-Anchor" href="#使用oh-my-zsh"></a> 使用oh-my-zsh</h2><p>安装 zsh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">sudo</span> apt update &amp;&amp; apt install zsh<br></code></pre></td></tr></table></figure><p>安装 oh-my-zsh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sh -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span><br></code></pre></td></tr></table></figure><p>安装插件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions<br>git <span class="hljs-built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">vim ~/.zshrc<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">plugins=(git zsh-autosuggestions zsh-syntax-highlighting history-substring-search)<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> ~/.zshrc<br></code></pre></td></tr></table></figure><br><blockquote><p>参考：</p><ul><li><p><a href="https://learn.microsoft.com/zh-cn/windows/wsl/networking">wsl</a></p></li><li><p><a href="https://docs.docker.com/engine/cli/proxy/">docker-cli-proxy</a></p><p><a href="https://docs.docker.com/engine/daemon/proxy/">docker-daemon-proxy</a></p></li><li><p><a href="https://ohmyz.sh/">ohmyzsh</a></p></li><li><p><a href="https://zh.wikipedia.org/wiki/%E6%97%A0%E7%B1%BB%E5%88%AB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1">NAT</a></p></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> learn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wsl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>classloader(1)</title>
      <link href="/2024/05/10/java-learn/classloader(1)/"/>
      <url>/2024/05/10/java-learn/classloader(1)/</url>
      
        <content type="html"><![CDATA[<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/05/10/java-learn/classloader(1)/d5a4c92f2400277998676178fc70e8f6.png" alt="他们以为我疯了，其实我成了白日梦想家。"></p><blockquote><p>java 中的ClassLoader 用于<strong>动态</strong>加载java程序运行时所需要的资源：包括要装配进jvm的class字节码文件以及一些其他资源文件。</p></blockquote><h2 id="java中的几种classloader"><a class="markdownIt-Anchor" href="#java中的几种classloader"></a> Java中的几种ClassLoader</h2><h3 id="bootstrapclassloader"><a class="markdownIt-Anchor" href="#bootstrapclassloader"></a> BootStrapClassLoader</h3><p><strong>关于BootStrapClassLoader的作用</strong></p><blockquote><p>java里class是被java.lang.ClassLoader加载的，那么，问题是，谁来加载ClassLoader呢？</p><p>–&gt;&gt;There is where the bootstrap or primordial class loader comes into play.</p><p>BootStrapClassLoader 是其他CLassLoder的顶级parent，其实现是jvm的一部分，被编写在jvm本地代码中，并不以class的形式存在java里，因此它也会随着jvm的不同而不同。并且在java里面被代表为<strong>null</strong>。</p></blockquote><p><strong>BootstrapCLassLoader负责加载：</strong></p><p><strong>java8以及之前：</strong></p><ul><li>jdk的核心类，比如 <code>%JAVA_HOME%/jre/lib</code>下的 <code>rt.jar</code>和其中的其他核心库。</li></ul><p><strong>java9模块化之后：</strong></p><ul><li>这些核心类库以一种更加高效的方式存储在<code>%JAVA_HOME%/lib</code>下面（关于这个目录下一些文件的作用。。。）</li><li>BootstrapClassLoader加载的模块(一部分)：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">moduleClassLoader</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">ModuleLayer</span> <span class="hljs-variable">layer</span> <span class="hljs-operator">=</span> ModuleLayer.boot();<br>        layer.modules()<br>                .stream()<br>                .filter(m-&gt; m.getClassLoader()==<span class="hljs-literal">null</span>)<br>                .forEach(<span class="hljs-keyword">module</span> -&gt; &#123;<br>            <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">module</span>.getClassLoader();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">classLoaderName</span> <span class="hljs-operator">=</span> classLoader==<span class="hljs-literal">null</span> ? <span class="hljs-string">&quot;bootstrap&quot;</span> : classLoader.getName();<br>            System.out.println(classLoaderName + <span class="hljs-string">&quot;: &quot;</span> + <span class="hljs-keyword">module</span>.getName());<br>        &#125;);<br>    &#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">sout&gt;&gt;</span><br><span class="hljs-comment">bootstrap: java.base</span><br><span class="hljs-comment">bootstrap: java.rmi</span><br><span class="hljs-comment">bootstrap: java.logging</span><br><span class="hljs-comment">bootstrap: java.security.sasl</span><br><span class="hljs-comment">bootstrap: jdk.nio.mapmode</span><br><span class="hljs-comment">bootstrap: java.prefs</span><br><span class="hljs-comment">bootstrap: java.instrument</span><br><span class="hljs-comment">bootstrap: java.xml</span><br><span class="hljs-comment">bootstrap: java.datatransfer</span><br><span class="hljs-comment">bootstrap: jdk.naming.rmi</span><br><span class="hljs-comment">bootstrap: jdk.sctp</span><br><span class="hljs-comment">bootstrap: jdk.jfr</span><br><span class="hljs-comment">bootstrap: jdk.management.jfr</span><br><span class="hljs-comment">bootstrap: java.desktop</span><br><span class="hljs-comment">bootstrap: jdk.unsupported</span><br><span class="hljs-comment">bootstrap: jdk.net</span><br><span class="hljs-comment">bootstrap: java.management.rmi</span><br><span class="hljs-comment">bootstrap: java.management</span><br><span class="hljs-comment">bootstrap: java.naming</span><br><span class="hljs-comment">bootstrap: jdk.management</span><br><span class="hljs-comment">bootstrap: jdk.management.agent</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h3 id="platform-classloaderextension-classloader"><a class="markdownIt-Anchor" href="#platform-classloaderextension-classloader"></a> PlatForm ClassLoader(Extension ClassLoader)</h3><p><strong>加载jdk 其他core类库，以供所有application使用</strong></p><p>**java8及以前： **</p><ul><li>加载 <code>%JAVA_HOME%/jre/lib/ext</code>下的jar以及 <code>java.ext.dirs</code>system propertry指定的目录下的jar</li></ul><p><strong>java9</strong><br>PlatformClassLoader加载的模块(一部分)：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">platform: java.xml.crypto<br>platform: jdk.jsobject<br>platform: jdk.crypto.ec<br>platform: jdk.httpserver<br>platform: jdk.security.jgss<br>platform: java.scripting<br>platform: jdk.localedata<br>platform: jdk.crypto.mscapi<br>platform: java.sql.rowset<br>platform: jdk.accessibility<br>platform: java.sql<br>platform: java.smartcardio<br>platform: jdk.charsets<br>platform: jdk.naming.dns<br>platform: jdk.crypto.cryptoki<br>platform: jdk.zipfs<br>platform: java.transaction.xa<br>platform: jdk.dynalink<br>platform: jdk.xml.dom<br>platform: jdk.security.auth<br>platform: java.compiler<br>platform: java.net.http<br>platform: java.security.jgss<br></code></pre></td></tr></table></figure><h3 id="systemclassloader"><a class="markdownIt-Anchor" href="#systemclassloader"></a> SystemClassLoader</h3><blockquote><p>用于加载类路径以及模块路径上的应用级别的class。</p></blockquote><p><strong>java8及以前： 命令行的 ：</strong>  <code>java [-classpath|-cp] /path/to/classes:/path/to/lib/* package.to.MainClass</code></p><p><strong>java9以后还可以：</strong>  <code>java --module-path /path/to/modules -m mainModule/package/to/MainClass</code></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-modularity</title>
      <link href="/2024/04/22/java-learn/java-modularity/"/>
      <url>/2024/04/22/java-learn/java-modularity/</url>
      
        <content type="html"><![CDATA[<h2 id="concept"><a class="markdownIt-Anchor" href="#concept"></a> CONCEPT</h2><blockquote><p>在java9，java引入了一种不同于，或者可以说是在 <code>package</code> 之上的一个新的抽象层–&gt; JPMS。</p><p>什么是module。 module是一系列相关的package与resource的集合</p><p>module的两种表现形式： <code>jar</code>与<code>已编译项目</code></p></blockquote><h3 id="module-properties"><a class="markdownIt-Anchor" href="#module-properties"></a> Module-Properties</h3><ul><li><code>name</code> ： Module的<code>name</code>命名方式与<code>package</code>相同，<code>goupId</code>反写。</li><li><code>requires | uses</code> Module所依赖的其他模块 | 服务。所有模块都直接或者间接依赖<code>java.base</code>。</li><li><code>exports</code>Module公开的可以被其他模块依赖的 package</li><li><code>provides</code> Module 提供的服务</li><li><code>open&lt;module level&gt; | opens&lt;package level&gt;</code> 其他module对私有包的反射权限</li></ul><h3 id="module-type"><a class="markdownIt-Anchor" href="#module-type"></a> Module-Type</h3><ul><li><strong>系统Module:</strong> 包括根据javaSE标准实现的<code>java</code>开头的module和 jdk内部使用的module</li><li><strong>应用级别Module:</strong> 具有<code>module-info.java</code>描述文件的我们自定义与第三方jar或者编译项目</li><li><strong>自动Module:</strong> 被添加在<code>--module-path</code>模块路径上的<strong>没有<code>module-info.java</code></strong> 的<code>jar</code>,他们通常取 <code>example-1.0-GA.jar</code>中的<code>example</code>作为module名，可以用<code>jdeps</code>查看到</li><li><strong>未命名Module:</strong> 被添加在 <code>--class-path</code> 类路径上的  <code>class</code>或者 <code>jar</code>都被加到 <code>Unnamed Module</code></li></ul><h3 id="module-infojava"><a class="markdownIt-Anchor" href="#module-infojava"></a> module-info.java</h3><p><strong>参考 <a href="https://www.baeldung.com/java-modularity#module-declarations">baeldung-java-modularity-module-declarations</a></strong></p><h2 id="examples"><a class="markdownIt-Anchor" href="#examples"></a> Examples</h2><h3 id="simple-multiple-modules"><a class="markdownIt-Anchor" href="#simple-multiple-modules"></a> Simple-Multiple-Modules</h3><p>参考 <strong><a href="https://www.baeldung.com/java-modularity#putting-it-all-together">baeldung</a></strong></p><h3 id="maven-multiple-modules"><a class="markdownIt-Anchor" href="#maven-multiple-modules"></a> Maven-Multiple-Modules</h3><h4 id="cteate-maven-project"><a class="markdownIt-Anchor" href="#cteate-maven-project"></a> Cteate-Maven-Project</h4><blockquote><p>jdk为openjdk17。尝试构建带有其他依赖的maven模块化项目，包括未模块化的依赖与已经模块化的依赖。</p></blockquote><h5 id="project-struct"><a class="markdownIt-Anchor" href="#project-struct"></a> Project-Struct</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/04/22/java-learn/java-modularity/42c92bc4bb9963c6590693c25a6abd18.png" alt="screen-capture"></p><p>与之前不同的是，在<code>java</code>源码目录下，多了<code>module-info.java</code>文件。</p><h5 id="pomxml"><a class="markdownIt-Anchor" href="#pomxml"></a> pom.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.13<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.fastjson2<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>由于是模块化的project，所以如果依赖不仅要在<code>pom.xml</code>中声明引入，并且只要创建了  <code>module-info.java</code>文件，就要在其中写入相关配置，否则会编译失败。</p><h5 id="module-infojava-2"><a class="markdownIt-Anchor" href="#module-infojava-2"></a> <code>module-info.java</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">module</span> moduleA &#123;<br>    <span class="hljs-keyword">exports</span> world.langyu.provider;<br>    <span class="hljs-keyword">requires</span> org.mybatis;<br>    <span class="hljs-keyword">requires</span> com.alibaba.fastjson2;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="mainjava"><a class="markdownIt-Anchor" href="#mainjava"></a> <code>Main.java</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> world.langyu.provider;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON;<br><span class="hljs-keyword">import</span> org.apache.ibatis.io.Resources;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.Configuration;<br><span class="hljs-keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;work dir: &quot;</span> + System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>));<br>        run();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Configuration</span> <span class="hljs-variable">configuration</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>()<br>                .build(Resources.getResourceAsStream(<span class="hljs-string">&quot;mybatis-config.xml&quot;</span>))<br>                .getConfiguration();<br>        System.out.println(<span class="hljs-string">&quot;moduleA&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;none modularity dep: configuration of mybatis: &quot;</span>+ configuration.getVariables());<br>        System.out.println(<span class="hljs-string">&quot;modularity dep: fastjson: &quot;</span>+ JSON.class.getName());<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>目前看起来没有任何问题，然后<code>编译</code></p><h4 id="compile"><a class="markdownIt-Anchor" href="#compile"></a> Compile</h4><p>在模块根部录下：</p><p><code>javac -d .\target\classes -p &quot;D:\maven_local_repository\com\alibaba\fastjson2\fastjson2\2.0.10\fastjson2-2.0.10.jar;D:\maven_local_repository\org\mybatis\mybatis\3.5.13\mybatis-3.5.13.jar&quot; .\src\main\java\module-info.java .\src\main\java\world\langyu\provider\*.java</code></p><p>其中</p><ul><li><code>-d</code>选项指定编译的输出目录。</li><li><code>-p/--module-path</code>选项 指定应用代码依赖的外部模块的路径，通常是jar包路径。注意在<u>windows</u>下，参数要用<code>&quot;&quot;</code>包起来，并且多个路径之间用<code>;</code>隔开。</li><li>由于是单模块，后跟 <code>module-info.java</code>文件的路径。</li><li>最后列出要编译的<code>.java</code>文件的路径</li></ul><p>emmmm，不出意外的话就要出意外了<code>=_=</code>。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">.\src\main\java\module-info.java:4: 错误: 找不到模块: com.alibaba.fastjson2<br>    requires com.alibaba.fastjson2;<br>                        ^<br>1 个错误<br></code></pre></td></tr></table></figure><p>顺着这个报错就找到了<code>fastjson2</code>的github的issue，然后是他们的一个bug，本来生个版本就可以解决了，但我想看看到底是个什么问题-&gt;<a href="https://github.com/alibaba/fastjson2/issues/780">fastjson2-issue</a></p><p>维护的人修改这个bug是去修改了<code>core/pom.xml</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/04/22/java-learn/java-modularity/ff3fab2d5c28473038752c112b73b5dd.png" alt="screen-capture"></p><p>原来 <code>fastjson2</code>使用的一个<a href="https://github.com/moditect/moditect">第三方插件</a>来做的模块化，它的编译产物还是java8的。</p><p>换完版本之后顺利编译</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/04/22/java-learn/java-modularity/dbd0caa5f6554acecf13a7839f550dd4.png" alt="screen-capture"></p><p>因为我们要依赖一些静态配置资源，copy过去。</p><p>运行</p><h5 id="non-modular-mode"><a class="markdownIt-Anchor" href="#non-modular-mode"></a> Non-modular-Mode</h5><p><strong>执行： <code>java -cp &quot;.\target\classes;D:\maven_local_repository\com\alibaba\fastjson2\fastjson2\2.0.15\fastjson2-2.0.15.jar;D:\maven_local_repository\org\mybatis\mybatis\3.5.13\mybatis-3.5.13.jar&quot; world.langyu.provider.Main</code></strong></p><ul><li><code>cp</code>指定所有涉及到的类路径。</li><li>最后带上主类的全限定名。</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/04/22/java-learn/java-modularity/3786ac2bef1e20ca5b2c49f9694c9883.png" alt="screen-capture"></p><h5 id="run-as-simple-jar"><a class="markdownIt-Anchor" href="#run-as-simple-jar"></a> run-as-simple-jar</h5><p><code>pom.xml</code>中配置<code>mainclass</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>world.langyu.provider.Main&lt;/mainC<br>                        lass&gt;<br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>首先要打成<code>jar</code>包-&gt;<code>mvn clean package</code></p><p><strong>执行：<code>java -p &quot;D:\maven_local_repository\com\alibaba\fastjson2\fastjson2\2.0.15\fastjson2-2.0.15.jar;D:\maven_local_repository\org\mybatis\mybatis\3.5.13\mybatis-3.5.13.jar&quot; --add-modules com.alibaba.fastjson2,org.mybatis -jar .\target\moduleA-1.0-SNAPSHOT.jar</code></strong></p><p><strong>注意：</strong></p><ul><li><code>-p</code>指定所依赖的<code>jar</code>的路径，<code>-p</code>的全称是<code>--module-path</code>,虽说是<code>module</code>，但是 JPMS中，<code>module</code>的分发产物依然是<code>jar</code>形式。</li><li><code>fastjson2</code>是个模块化的jar，可以在 <code>fastjson2-2.0.15.jar!\META-INF\versions\9\module-info.class</code>找到模块描述文件，里面自然有module-name，所以在后面<code>--add-modules</code>指定的参数中就可以指定其定义的<code>com.alibaba.fastjson2</code>。但奇怪的是，<code>mybatis</code>分发的jar中我并没有找到<code>module-info.java</code>，这个名称我是从在编写<code>moduleA</code>的<code>module-info.java</code>文件时，<code>idea</code>提示我的所要<code>requires</code>的module-name,但按理来说，如果你没有模块化，那就会转为<code>Automatic-Module</code>,模块名默认是<code>xxxlib-1.0-xx.jar</code>中的<code>xxxlib</code>，也就是版本号前面的内容，但这时的<code>mybatis</code>并符合预期。</li></ul><p>于是我顺藤摸瓜，去翻了<code>mybatis</code>的jar，然后在其中的<code>META_INF/MANIFEST.MF</code>中找到了</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2024/04/22/java-learn/java-modularity/7060d4528070a203486153c501e585c3.png" alt="86a11f912c46fe4bc8d51af9602e27d8.png"></p><p>有种解密的味道哈哈哈—~~~</p><p>原来<code>mybatis</code>这个编译的版本是<code>jdk17</code>，看来<code>mybatis</code>模块化的做法很简单：</p><p><strong>利用了 Automatic-Module</strong>机制：</p><ol><li>它没有<code>module-info.java</code>文件，当被其他开发者作为依赖添加到模块路径上(<code>-p</code>)时,他会成为一个自动模块：1. <code>export and open all packages</code> 2. <code>have full read access to every other module loaded by the module path</code></li><li>通过在 <code>MANIFEST.MF</code>文件中指定<code>Automatic-Module-Name</code>来覆盖默认的module-name。</li><li>要做到 <code>2.</code> 可以在<code>pom.xml</code>中配置<code>maven-jar-plugin</code></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">manifestEntries</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">Automatic-Module-Name</span>&gt;</span>$&#123;module.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Automatic-Module-Name</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">manifestEntries</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><p>然后其他模块就可以用<code>$&#123;module.name&#125;</code>来生命对这个模块的依赖。</p><p>顺带提一嘴，我在测试的时候发现，<code>idea</code>可以在你指定了<code>Automatic-Module-Name</code>或者这个模块的 <code>artifactId</code>(这个是因为如果不指定jar的名称，默认是<code>$&#123;artifactId&#125;-&#123;version&#125;.jar</code>)然后<code>reload maven projects</code>后 提示或识别出来的module-name。</p><p>一直很想找到能这样做的出处(在<code>MANIFEST.MF</code>中指定 <code>Automatic-Module-Name</code>),推测是<code>JEP</code>讨论出来的。</p><ul><li><a href="https://mail.openjdk.org/pipermail/jpms-spec-experts/2017-February/000582.html">mail.openjdk-how to name modules, automatic and otherwise</a></li><li><a href="https://mail.openjdk.org/pipermail/jigsaw-dev/2017-January/011106.html">Automatic module names</a></li><li><a href="https://maven.apache.org/shared/maven-archiver/examples/manifestEntries.html">maven-jar-plugin</a></li><li><a href="https://dev.java/learn/modules/automatic-module/#module-resolution-for-automatic-modules">dev.java</a></li></ul><h4 id="编译与运行中有关unnamed-module的问题"><a class="markdownIt-Anchor" href="#编译与运行中有关unnamed-module的问题"></a> 编译与运行中有关Unnamed-Module的问题</h4><h5 id="什么是unnamed-module"><a class="markdownIt-Anchor" href="#什么是unnamed-module"></a> 什么是Unnamed-Module</h5><blockquote><p>被添加到–class-path中的classes与jar都会被加到Unnamed-Module中。</p><p>Unnamed-Module具有如下特性：</p><ol><li>Export and open all its packages to every other module, like the Automatic Module.</li><li>Other module can only access classes in Unname-Module by reflection</li><li>The declaration of dependencies by the unnamed module on other modules is futile at runtime.</li></ol></blockquote><p>未命名模块就是所有放在<code>-classpath</code>上的类、模块的一个大杂烩模块。因为是<code>未命名</code>，所以不能被其他模块直接依赖，其他模块只能通过反射的方式访问其中的类，对应<code>1、2</code>两点。</p><p>关于第三点：未命名模块中对外部声明的依赖（即使是在<code>module-info.java</code>中生命的  <code>require</code>）不会被模块系统自动解析和加载，除非此时未命名模块是<code>root module</code>其中之一。</p><h5 id="问题复现"><a class="markdownIt-Anchor" href="#问题复现"></a> 问题复现</h5><p>比如：<strong>现在有A,B两个jar，jarA，jarB都具有module-info.java，也就是都是模块化后的jar，jarB代码层面只依赖于jarA()。</strong></p><p><strong>jarB：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">module</span> moduleB &#123;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>jarA:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">module</span> moduleA &#123;<br>    <span class="hljs-keyword">requires</span> org.mybatis;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>执行：</strong> <code>java -classpath D:\source-read\java-module\moduleA\target\moduleA-1.0-SNAPSHOT.jar -p &quot;D:\source-read\java-module\moduleB\target\moduleB-1.0-SNAPSHOT.jar;D:\maven_local_repository\org\mybatis\mybatis\3.5.13\mybatis-3.5.13.jar&quot; -m moduleB/world.langyu.consumer.Main</code></p><p><strong>注意此时我们将 jarA放在了 类路径上，所以jarA是Unnamed-Module的一部分。所以即使moduleA声明了对mybatis的依赖，但还是会得到如下报错：</strong></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">Caused by: java.lang.ClassNotFoundException: org.apache.ibatis.session.SqlSessionFactoryBuilder<br>        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)<br>        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)<br>        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)<br>        ... 6 more<br><br></code></pre></td></tr></table></figure><h5 id="问题分析"><a class="markdownIt-Anchor" href="#问题分析"></a> 问题分析</h5><p>在启动参数上加上<code>--show-module-resolution</code>来查看 <a href="https://stackoverflow.com/questions/48339598/list-the-modules-resolved-during-the-application-startup">modules resolved during app startup</a>。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">root moduleB file:///D:/source-read/java-module/moduleB/target/moduleB-1.0-SNAPSHOT.jar<br>java.base binds java.desktop jrt:/java.desktop<br>java.base binds jdk.security.auth jrt:/jdk.security.auth<br>java.base binds java.management jrt:/java.management<br>java.base binds jdk.localedata jrt:/jdk.localedata<br>java.base binds java.logging jrt:/java.logging<br>...<br></code></pre></td></tr></table></figure><p>看来mybatis的模块并没有被解析加载到运行时环境中。</p><p>这就要提到java模块化系统中的模块发现机制(<a href="https://docs.oracle.com/en%2Fjava%2Fjavase%2F11%2Fdocs%2Fapi%2F%2F/java.base/java/lang/module/package-summary.html#:~:text=Resolution%20is%20the%20process%20of,a%20set%20of%20root%20modules.">module resolution</a>）</p><ul><li>java.base是所有模块的根模块，不需要显式声明。</li><li>编译与运行中，模块系统需要先确定一个或者多个root-module，然后根据这些root-module的依赖关系去<code>-p</code>指定的模块路径下寻找所有可以<code>观察到的模块（observable module）</code>然后解析加载以满足依赖，再加上<code>-cp</code>指定的类路径，就构成了编译与运行时环境。</li><li>通过<code>-m</code>方式启动，<code>-m</code>指定的模块就是root-module之一。</li><li>如果是传统方式<code>java [options] &lt;主类&gt; [args...]</code>，则root-module 就是 <code>java.*</code>（<code>java.base</code>、<code>java.sql</code>…）模块，也就是<code>JRE</code>。</li></ul><p>在这个例子中(通过<code>-m</code>)，<code>moduleB</code>是root-module，<strong><code>moduleB、java.base、jarA</code><strong>构成了运行时环境（<strong>注意即使<code>mybatis</code>模块</strong>也在模块路径上，但运行时环境不包含他。），因为<code>jarA</code>被添加到了类路径上，是个Unnamed-Module，不会有其它模块对他有显式的依赖，并且他也不可能是root-module，所以是</strong>不会去解析</strong>Unnamed-Module的依赖关系的，自然<code>mybatis</code>模块没有被加入到运行时环境中。</p><h5 id="解决方案"><a class="markdownIt-Anchor" href="#解决方案"></a> 解决方案</h5><p>这时就需要手动把<code>org.mybatis</code>从模块路径上添加到被解析模块中：<code>-add-modules org.mybatis, java.sql</code>。(mybatis模块还依赖于<code>java.sql</code>)</p><p>或者</p><p>直接采用传统方式启动，把类和jar都放在类路径上：<code>java -classpath &quot;D:\source-read\java-module\moduleA\target\moduleA-1.0-SNAPSHOT.jar;D:\source-read\java-module\moduleB\target\moduleB-1.0-SNAPSHOT.jar;D:\maven_local_repository\org\mybatis\mybatis\3.5.13\mybatis-3.5.13.jar&quot; world.langyu.consumer.Main</code></p><br><p>结束哩 😹</p><p>其他相关</p><ul><li><p><a href="https://www.oracle.com/corporate/features/understanding-java-9-modules.html">oracle</a></p></li><li><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1281795926523938">liaoxuefeng.com/wiki</a></p></li><li><p><a href="https://www.baeldung.com/java-modularity">baeldung-java-modularity</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx</title>
      <link href="/2023/08/08/linux/nginx/"/>
      <url>/2023/08/08/linux/nginx/</url>
      
        <content type="html"><![CDATA[<h3 id="安装"><a class="markdownIt-Anchor" href="#安装"></a> 安装</h3><h4 id="手动编译"><a class="markdownIt-Anchor" href="#手动编译"></a> 手动编译</h4><ul><li>下载源码 <a href="https://nginx.org/en/download.html">源码</a></li><li>编译安装 <a href="https://nginx.org/en/docs/configure.html">make &amp;&amp; install</a></li></ul><h4 id="yun-rpm包"><a class="markdownIt-Anchor" href="#yun-rpm包"></a> yun + rpm包</h4><p>查看 linux 发行版本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[]$ lsb_release -a<br><br>LSB Version:    :core-4.1-amd64:core-4.1-noarch<br>Distributor ID:    CentOS<br>Description:    CentOS Linux release 7.9.2009 (Core)<br>Release:    7.9.2009<br>Codename:    Core<br></code></pre></td></tr></table></figure><p>对应rpm包下载地址  <a href="http://nginx.org/packages/centos/7/x86_64/RPMS/">nginx rpm 包</a></p><p>三种安装方式</p><ul><li>线上下载 rpm 包 然后安装 (要自己解决依赖问题)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">sudo rpm -Uvh http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.20.2-1.el7.ngx.x86_64.rpm<br></code></pre></td></tr></table></figure><ul><li>离线 通过下载好的 rpm文件 使用 yum 安装 (无须手动解决依赖问题)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">yum install nginx-1.22.0-1.el7.ngx.x86_64.rpm<br></code></pre></td></tr></table></figure><ul><li>官网教程</li></ul><p><a href="https://nginx.org/en/linux_packages.html">linux_package</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo yum install yum-utils<br>sudo vim /etc/yum.repos.d/nginx.repo<br><br>[nginx-stable]<br>name=nginx stable repo<br>baseurl=http://nginx.org/packages/centos/$releasever/$basearch/<br>gpgcheck=1<br>enabled=1<br>gpgkey=https://nginx.org/keys/nginx_signing.key<br>module_hotfixes=true<br><br>[nginx-mainline]<br>name=nginx mainline repo<br>baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/<br>gpgcheck=1<br>enabled=0<br>gpgkey=https://nginx.org/keys/nginx_signing.key<br>module_hotfixes=true<br><br>sudo yum install -y nginx<br></code></pre></td></tr></table></figure><p><strong>yum 使用</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># 列出 软件包<br># --showduplicates 参数 表示展示出 多版本 <br>yum list &lt;package_name&gt;<br># 已经安装的<br>yum list installed &lt;package_name&gt;<br># 可安装的<br>yum list available &lt;package_name&gt;<br># 在当前源内搜索软件包<br>yum --showduplicates search nginx<br></code></pre></td></tr></table></figure><h4 id="docker"><a class="markdownIt-Anchor" href="#docker"></a> docker</h4><p><strong>Dockerfile</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> nginx<br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /tmp/nginx</span><br><span class="hljs-comment"># https 配置文件</span><br><span class="hljs-keyword">ADD</span><span class="language-bash"> ./https/* /tmp/nginx/</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">443</span><br></code></pre></td></tr></table></figure><p><strong>docker compose</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">version: <span class="hljs-string">&quot;3.8&quot;</span><br>services:<br>  nginx:<br>    container_name: myNginx<br>    build:<br>      context: .<br>      dockerfile: Dockerfile<br>    image: jyxzwd/nginx:latestcd<br>    volumes:<br>      <span class="hljs-comment"># 挂载页面</span><br>      - ./html:/usr/myhtml<br>      <span class="hljs-comment"># 挂载配置</span><br>      - ./conf.d:/etc/nginx/conf.d<br>    ports:<br>      - <span class="hljs-string">&quot;80:80&quot;</span><br>      - <span class="hljs-string">&quot;443:443&quot;</span><br>    logging:<br>      driver: <span class="hljs-string">&quot;json-file&quot;</span><br>      options:<br>        max-size: <span class="hljs-string">&quot;2g&quot;</span><br>        max-file: <span class="hljs-string">&quot;10&quot;</span><br>    restart: always<br></code></pre></td></tr></table></figure><br><p><strong>default.conf</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span>  [::]:<span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  domain;<br><br>    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$host</span> = <span class="hljs-string">&#x27;langyu.world&#x27;</span>) &#123;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^/(.*)$</span> https://domain/<span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br>    &#125;<br><br>    <span class="hljs-comment">#error_page  404              /404.html;</span><br><br>    <span class="hljs-comment"># redirect server error pages to the static page /50x.html</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>    <span class="hljs-section">location</span> = /50x.html &#123;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>    &#125;<br><br>    <span class="hljs-comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#location ~ \.php$ &#123;</span><br>    <span class="hljs-comment">#    proxy_pass   http://127.0.0.1;</span><br>    <span class="hljs-comment">#&#125;</span><br><br>    <span class="hljs-comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#location ~ \.php$ &#123;</span><br>    <span class="hljs-comment">#    root           html;</span><br>    <span class="hljs-comment">#    fastcgi_pass   127.0.0.1:9000;</span><br>    <span class="hljs-comment">#    fastcgi_index  index.php;</span><br>    <span class="hljs-comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br>    <span class="hljs-comment">#    include        fastcgi_params;</span><br>    <span class="hljs-comment">#&#125;</span><br><br>    <span class="hljs-comment"># deny access to .htaccess files, if Apache&#x27;s document root</span><br>    <span class="hljs-comment"># concurs with nginx&#x27;s one</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment">#location ~ /\.ht &#123;</span><br>    <span class="hljs-comment">#    deny  all;</span><br>    <span class="hljs-comment">#&#125;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><br><p><strong>https.conf</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><br><br>    <span class="hljs-attribute">listen</span>  <span class="hljs-number">443</span> ssl http2;<br>    <span class="hljs-attribute">listen</span>  [::]:<span class="hljs-number">443</span> http2;<br>    <span class="hljs-attribute">server_name</span>     domain;<br><br>    <span class="hljs-attribute">ssl_certificate</span>     /tmp/nginx/domain_crt;<br>    <span class="hljs-attribute">ssl_certificate_key</span>     /tmp/nginx/domain_key;<br>    <span class="hljs-attribute">ssl_session_timeout</span>     <span class="hljs-number">10m</span>;<br>    <span class="hljs-attribute">ssl_protocols</span>   TLSv1 TLSv1.<span class="hljs-number">1</span> TLSv1.<span class="hljs-number">2</span>;<br><br><br>    <span class="hljs-attribute">access_log</span>  /var/log/nginx/access.log  main;<br>    <span class="hljs-attribute">error_log</span>   /var/log/nginx/<span class="hljs-literal">error</span>.log;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">root</span>   /usr/myhtml;<br>        <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html<br>        index  index.html index.htm;<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure><br><p><strong>command <code>sudo docker compose -f compose.y</code></strong></p><br><h3 id="nginx-操作"><a class="markdownIt-Anchor" href="#nginx-操作"></a> nginx 操作</h3><ul><li><p>启动 <code>systemctl start nginx</code></p></li><li><p>查看运行状态 <code>systemctl status nginx</code></p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/08/linux/nginx/58d03e15e320f0f8206a143c86bfb162.png" alt="screen-capture"></p><p><strong>master 进程 通常 是属于root 的，用来管理 其他的 worker 进程，worker进程数在配置文件中国指定，通常数量为cpu核心数</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/08/linux/nginx/ee150da8222a2d0e2b8bd87088aa7d07.png" alt="screen-capture"></p><ul><li>nginx -s [stop | quit | reload | reopen ] 需要root权限 由 master进程执行</li></ul><h3 id="nginx配置"><a class="markdownIt-Anchor" href="#nginx配置"></a> nginx配置</h3><h4 id="location-块"><a class="markdownIt-Anchor" href="#location-块"></a> location 块</h4><blockquote><p>Synatx:  location [ = | ~ | ~* | ^~ ] uri { . . .}</p><p>Context: http server</p></blockquote><p><strong>匹配规则</strong></p><ul><li>首先去顺序寻找匹配 <code>前缀字符串</code> ，并且记录下来 <code>最长前缀的location</code></li><li>然后去<code>顺序寻找匹配正则表达式的字符串</code>，在找到第一个匹配之后终止 <a href="#a-%E6%83%85%E5%86%B5">A</a></li><li>如果 <code>最长前缀的location</code> 被 <code>^~</code> 修饰，则不会再去 <code>顺序寻找匹配正则表达式的字符串</code>。</li><li>如果在 <code>正则表达式的字符串</code>中没有找到任何一个匹配，则使用前面记录的<code>最长前缀字符串</code>所在<code>location</code>定义的<code>configuration</code>  <a href="#b-%E6%83%85%E5%86%B5">B</a></li><li>在以上过程中，一旦 <code>=</code>定义的<code>location</code>块 被匹配，则终止匹配 <a href="#c-%E6%83%85%E5%86%B5">C</a></li></ul><br><p><code>exercise.conf</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/08/linux/nginx/be179ba4a47835bfdc1fa65376951cc6.png" alt="screen-capture"></p><h4 id="几种情况"><a class="markdownIt-Anchor" href="#几种情况"></a> 几种情况</h4><h5 id="c-情况"><a class="markdownIt-Anchor" href="#c-情况"></a> C-情况</h5><p><code>curl -iv http://localhost:81/doc</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/08/linux/nginx/9572f12a013ccb33c57422c818f0b7da.png" alt="screen-capture"></p><p><strong>找到 <code>=</code>就立马终止</strong></p><h4 id="a-情况"><a class="markdownIt-Anchor" href="#a-情况"></a> A 情况</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/08/linux/nginx/6a4be9a6f191e3e893a82320795b3ab5.png" alt="screen-capture"></p><p><code>curl -iv http://localhost:81/doc/index.html</code></p><br><h4 id="b-情况"><a class="markdownIt-Anchor" href="#b-情况"></a> B-情况</h4><p><code>curl -iv http://localhost:81/do</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/08/linux/nginx/f0c057aaab14cf5957b4a6205b2e051c.png" alt="screen-capture"></p><br><h4 id="root"><a class="markdownIt-Anchor" href="#root"></a> root</h4><p><strong>指定静态资源目录，可用在 http, server, location 块</strong></p><blockquote><p>Syntax: root path</p><p>Default: html</p><p>Context: http, server, location, if in location</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /image &#123;<br>      <span class="hljs-attribute">root</span> /home/static;<br>&#125;<br>langyu.world/image/1.<span class="hljs-attribute">jpg</span> -&gt; /home/static/image/<span class="hljs-number">1</span>.jpg<br></code></pre></td></tr></table></figure><p>相当于 root指定路径与 URI 叠加，如果要更改URI，则使用 <a href="#alias">alias</a></p><h4 id="alias"><a class="markdownIt-Anchor" href="#alias"></a> alias</h4><blockquote><p>Syntax: alias path</p><p>Default: -------</p><p>Context: location</p></blockquote><br>重命名指向 只能用在 location<br><p><strong>注意alias后面要加 '/'</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /music &#123; <br>    <span class="hljs-attribute">alias</span> /home/static/blog_music/;<br>&#125;<br>langyu.world/music/jyx.<span class="hljs-attribute">mp3</span> -&gt; /home/static/blog_music/jyx.mp3<br><br>location <span class="hljs-regexp">~ ^/user/(.+\.(?:png|jpe?g|gif))$</span> &#123;<br>    <span class="hljs-attribute">alias</span> /data/images/<span class="hljs-variable">$1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="rewrite"><a class="markdownIt-Anchor" href="#rewrite"></a> rewrite</h4><p>重写 URL ,用在 location, server, if</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">rewrite &lt;regex&gt; &lt;replacement&gt; [flag]<br>regex 正则表达式 匹配<br></code></pre></td></tr></table></figure><p>eg: <code>rewrite ^/(.*)$ https://domain/$1 permanent</code></p><h3 id="nginx解决跨域"><a class="markdownIt-Anchor" href="#nginx解决跨域"></a> nginx解决跨域</h3><p><strong>前端部署的域名与端口和要访问的后端api域名和端口保持一致</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">http</span> &#123;<br>     <span class="hljs-section">upstream</span> server &#123;<br>         <span class="hljs-attribute">server</span> localhost:<span class="hljs-number">8081</span> weigth=<span class="hljs-number">3</span>;<br>         <span class="hljs-attribute">server</span> localhost:<span class="hljs-number">8082</span> weigth=<span class="hljs-number">2</span>;<br>         <span class="hljs-attribute">server</span> localhost:<span class="hljs-number">8083</span> weigth=<span class="hljs-number">1</span>;<br>     &#125;<br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2;<br>        <span class="hljs-attribute">server_name</span> localhost;<br>        <br>        <span class="hljs-section">location</span> /html/ &#123;<br>            <span class="hljs-attribute">root</span> html;<br>        &#125;<br>        <span class="hljs-section">location</span> /api/v2 &#123;<br>            <span class="hljs-attribute">proxy_pass</span> https://server;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure><h3 id="https配置"><a class="markdownIt-Anchor" href="#https配置"></a> https配置</h3><p><strong>yum 下载的nginx 默认预装了ssl模块</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">nginx -V <br>...<br>configure arguments: --with-http_ssl_module<br></code></pre></td></tr></table></figure><ul><li>配置文件</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>  <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl http2 default_server;   <span class="hljs-comment"># SSL 访问端口号为 443</span><br>  <span class="hljs-attribute">server_name</span> domain;         <span class="hljs-comment"># 填写绑定证书的域名</span><br>  <span class="hljs-attribute">ssl_certificate</span> /etc/nginx/https/domain.crt;   <span class="hljs-comment"># 证书地址</span><br>  <span class="hljs-attribute">ssl_certificate_key</span> /etc/nginx/https/domain.key;      <span class="hljs-comment"># 私钥地址</span><br>  <span class="hljs-attribute">ssl_session_timeout</span> <span class="hljs-number">10m</span>;<br>  <span class="hljs-attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="hljs-number">1</span> TLSv1.<span class="hljs-number">2</span>; <span class="hljs-comment"># 支持ssl协议版本，默认为后三个，主流版本是[TLSv1.2]</span><br>  <br>  <span class="hljs-section">location</span> / &#123;<br>    <span class="hljs-attribute">root</span>         /home/nginx/html/blog;<br>    <span class="hljs-attribute">index</span>        index.html index.htm;<br>    <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>  &#125;<br>  <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh</title>
      <link href="/2023/08/05/linux/ssh/"/>
      <url>/2023/08/05/linux/ssh/</url>
      
        <content type="html"><![CDATA[<h3 id="ssh-公钥认证登录-public-key-authentication"><a class="markdownIt-Anchor" href="#ssh-公钥认证登录-public-key-authentication"></a> ssh 公钥认证登录 <a href="https://www.ssh.com/academy/ssh/public-key-authentication">public key authentication</a></h3><h4 id="what-and-why"><a class="markdownIt-Anchor" href="#what-and-why"></a> what and why</h4><ul><li>比简单的用户名-口令登录要安全,他提供极长密码无法提供的密码强度</li><li>由一对 公钥(public key)  私钥(private key) 组成</li><li>使用非对称加密算法, rsa dsa ed25519</li></ul><h5 id="公钥public-key"><a class="markdownIt-Anchor" href="#公钥public-key"></a> 公钥(public key)</h5><blockquote><p>公钥用于被拷贝到目标服务器上，任何拥有其他者公钥的服务器都可以加密数据，但只有持有相应私钥的人才能正确解密数据。一旦服务器收到用户发送的公钥并且认为该公钥可信，服务器就会在 authorized_keys 文件中标记该公钥可信，此类密钥(authorized 中的公钥们 )称为 授权密钥。</p></blockquote><h5 id="私钥private-key"><a class="markdownIt-Anchor" href="#私钥private-key"></a> 私钥(private key)</h5><blockquote><p>私钥应仅被用户自己保留，只有持有与目标服务器上公钥对应的私钥才能通过身份认证，被称为 身份密钥。</p></blockquote><h4 id="用ssh来进行-公钥认证登录"><a class="markdownIt-Anchor" href="#用ssh来进行-公钥认证登录"></a> 用ssh来进行 公钥认证登录</h4><ol><li>用户在本地创建密钥对，使用 <a href="https://www.ssh.com/academy/ssh/keygen">ssh-keygen</a>  <code>ssh-keygen -t &lt;encrypt algorithm&gt; -f &lt;fileName&gt; -b &lt;keySize&gt;</code></li><li>私钥仅在用户本地保存，而将公钥传输到目标服务器上，使用 <a href="https://www.ssh.com/academy/ssh/copy-id">ssh-copy-id</a>                                <code>ssh-copy-id -i &lt;myPublicKey&gt; user@host</code>  这个过程中需要验证在远程服务器的身份</li><li>在通过身份验证后，远程服务器存储公钥并标记为 已认证</li><li><code>ssh -i ~/privateKey user@host</code></li></ol><p><strong>也可以在 ~/.ssh/config 文件中配置</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">Host</span> <span class="hljs-string">&lt;connection_name&gt;</span><br>  <span class="hljs-string">HostName</span> <span class="hljs-string">&lt;host&gt;</span><br>  <span class="hljs-string">User</span> <span class="hljs-string">&lt;username&gt;</span><br>  <span class="hljs-string">Port</span> <span class="hljs-string">&lt;port&gt;</span><br>  <span class="hljs-string">IdentityFile</span> <span class="hljs-string">&lt;privateKeyFilePath&gt;</span><br></code></pre></td></tr></table></figure><p>然后 <code>ssh connection_name</code></p><p>结束力 😂</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/2023/08/05/linux/ssh/3f43eaf2bf17812c1f54bbc2263b9d3e.jpeg" alt="Ste.jpeg"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wiki_note</title>
      <link href="/2022/06/12/spring_boot/wiki_note/"/>
      <url>/2022/06/12/spring_boot/wiki_note/</url>
      
        <content type="html"><![CDATA[<h1 id="0-git-使用中的坑点"><a class="markdownIt-Anchor" href="#0-git-使用中的坑点"></a> 0、Git 使用中的&quot;坑点&quot;</h1><h2 id="00第一次推送报错"><a class="markdownIt-Anchor" href="#00第一次推送报错"></a> 0.0第一次推送报错</h2><p><strong>在gitee创建远程仓库后，并且自动创建了README.md文件后，在本地提交文件时,会报如下错误</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">error: failed to push some refs to ‘https://gitee.com/<br></code></pre></td></tr></table></figure><p><strong>原因：本地文件目录中没有远程仓库初始化时的README.md文件，导致推送出错</strong></p><p><strong>解决办法：将README.md文件拉取到本地</strong></p><p>:<code>git pull --rebase origin master</code></p><h1 id="1-一些文件配置"><a class="markdownIt-Anchor" href="#1-一些文件配置"></a> 1、一些文件配置</h1><h2 id="10"><a class="markdownIt-Anchor" href="#10"></a> 1.0</h2><p><strong>返回类</strong></p><p>** <a href="....%5CSSM%5CSpring%5CSSM_%5Csrc%5Cmain%5Cjava%5Ccom%5Cjyx%5Cpojo%5CCode.java">Code.java</a> **</p><p><a href="....%5CSSM%5CSpring%5CSSM_%5Csrc%5Cmain%5Cjava%5Ccom%5Cjyx%5Cpojo%5CResult.java">Result.java</a></p><h2 id="11-loback-springxml-文件配置"><a class="markdownIt-Anchor" href="#11-loback-springxml-文件配置"></a> 1.1 loback-spring.xml 文件配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 修改一下路径--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PATH&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;./log&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br><span class="hljs-comment">&lt;!--            &lt;Pattern&gt;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %highlight(%-5level) %blue(%-50logger&#123;50&#125;:%-4line) %thread %green(%-18X&#123;LOG_ID&#125;) %msg%n&lt;/Pattern&gt;--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %highlight(%-5level) %blue(%-30logger&#123;30&#125;:%-4line) %thread %green(%-18X&#123;LOG_ID&#125;) %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;TRACE_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;PATH&#125;/trace.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;PATH&#125;/trace.%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>10MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %-5level %-50logger&#123;50&#125;:%-4line %green(%-18X&#123;LOG_ID&#125;) %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;PATH&#125;/error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">FileNamePattern</span>&gt;</span>$&#123;PATH&#125;/error.%d&#123;yyyy-MM-dd&#125;.%i.log<span class="hljs-tag">&lt;/<span class="hljs-name">FileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>10MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %-5level %-50logger&#123;50&#125;:%-4line %green(%-18X&#123;LOG_ID&#125;) %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;ERROR&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;TRACE_FILE&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p><strong>配置文件的存放目录:/resources/</strong></p></li><li><p>在启动类添加代码</p></li><li><p>可以在控制台打印出首页地址</p></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG = LoggerFactory.getLogger(DemoApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;   SpringApplication app = <span class="hljs-keyword">new</span> SpringApplication(DemoApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;   Environment env = app.run(args).getEnvironment();   LOG.info(<span class="hljs-string">"启动成功！"</span>);   LOG.info(<span class="hljs-string">"地址:\t http://192.168.4.179:&#123;&#125;"</span>,env.getProperty(<span class="hljs-string">"server.port"</span>));&lt;!--code￼<span class="hljs-number">2</span>--&gt;</code></pre></li></ul><h1 id="3-springboot整合mybatis"><a class="markdownIt-Anchor" href="#3-springboot整合mybatis"></a> 3、SpringBoot整合Mybatis</h1><h2 id="30导入依赖与配置文件"><a class="markdownIt-Anchor" href="#30导入依赖与配置文件"></a> 3.0导入依赖与配置文件</h2><ul><li><p>导入依赖</p></li><li><pre class="highlight"><code class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>- 在application.yaml中配置datasource<br><br>- <br><br>- ```yaml<br>  spring:<br>    datasource:<br>      driver-class-name: com.mysql.cj.jdbc.Driver<br>      url: jdbc:mysql://localhost:3306/demo?useUnicode=true&amp;auseSSL=false&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8<br>      password: Jyx1314.+<br>      username: root<br>  mybatis:<br>    mapper-locations: classpath:mapper/**/*.xml<br></code></pre></td></tr></table></figure></span></code></pre></li></ul><p><strong>要注意的点</strong></p><ul><li><strong>此后配置的xxxMapper.xml文件一定要放在resources目录下，若放在mapper包下则无法静态资源导出！！！</strong></li></ul><h2 id="31-配置generato"><a class="markdownIt-Anchor" href="#31-配置generato"></a> 3.1 配置generato</h2><ul><li><p>导入依赖</p></li><li><pre class="highlight"><code class="java">&lt;plugin&gt;   &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;   &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;   &lt;version&gt;<span class="hljs-number">1.3</span><span class="hljs-number">.7</span>&lt;/version&gt;   &lt;configuration&gt;      &lt;configurationFile&gt;src/main/resources/generator/generator-config.xml&lt;/configurationFile&gt;      &lt;overwrite&gt;<span class="hljs-keyword">true</span>&lt;/overwrite&gt;      &lt;verbose&gt;<span class="hljs-keyword">true</span>&lt;/verbose&gt;   &lt;/configuration&gt;   &lt;dependencies&gt;      &lt;dependency&gt;         &lt;groupId&gt;mysql&lt;/groupId&gt;         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;         &lt;version&gt;<span class="hljs-number">8.0</span><span class="hljs-number">.22</span>&lt;/version&gt;      &lt;/dependency&gt;   &lt;/dependencies&gt;&lt;/plugin&gt;&lt;!--code￼<span class="hljs-number">4</span>--&gt;</code></pre></li></ul><h1 id="4-springboot-写接口"><a class="markdownIt-Anchor" href="#4-springboot-写接口"></a> 4、SpringBoot 写接口</h1><h2 id="40-设置统一返回类-result"><a class="markdownIt-Anchor" href="#40-设置统一返回类-result"></a> 4.0 设置统一返回类 (Result)</h2><ul><li><pre class="highlight"><code class="java"><span class="hljs-keyword">package</span> com.jyx.Utils;<span class="hljs-comment">/** * 同意返回结果类(泛型类) * * <span class="hljs-doctag">@param</span> &lt;T&gt; */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;    <span class="hljs-comment">//参数：message，code，还有一个泛型的date</span>    <span class="hljs-keyword">private</span> String message;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> code;    <span class="hljs-keyword">private</span> T data;    <span class="hljs-comment">//有参构造器</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Result</span><span class="hljs-params">(String message, <span class="hljs-keyword">int</span> code, T date)</span> </span>&#123;        <span class="hljs-keyword">this</span>.message = message;        <span class="hljs-keyword">this</span>.code = code;        <span class="hljs-keyword">this</span>.data =date;    &#125;    <span class="hljs-comment">//无参构造器</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Result</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Result</span><span class="hljs-params">(String message, <span class="hljs-keyword">int</span> code)</span> </span>&#123;        <span class="hljs-keyword">this</span>.message = message;        <span class="hljs-keyword">this</span>.code = code;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMessage</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> message;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMessage</span><span class="hljs-params">(String message)</span> </span>&#123;        <span class="hljs-keyword">this</span>.message = message;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCode</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> code;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> code)</span> </span>&#123;        <span class="hljs-keyword">this</span>.code = code;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">getData</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> data;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(T data)</span> </span>&#123;        <span class="hljs-keyword">this</span>.data = data;    &#125;    <span class="hljs-comment">//静态成功返回方法，返回的是一个统一返回类对象，包含date，message，code</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  &lt;T&gt; <span class="hljs-function">Result&lt;T&gt; <span class="hljs-title">success</span> <span class="hljs-params">(T Date, String message)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Result&lt;T&gt;(message, Code.SUCCESS.getValue(),Date);    &#125;    <span class="hljs-comment">//静态失败返回方法，返回对象中只包含message和code</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Result&lt;T&gt; <span class="hljs-title">error</span><span class="hljs-params">(String message)</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Result&lt;T&gt;(message, Code.ERROR.getValue());    &#125;    <span class="hljs-comment">//重写to_string 方法，用于展示结果</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span><span class="hljs-string">'&#123;'</span> +                <span class="hljs-string">"message="</span> + message + <span class="hljs-string">'\n'</span> +                <span class="hljs-string">"code="</span> + code +<span class="hljs-string">'\n'</span>+                <span class="hljs-string">"date="</span>+<span class="hljs-string">'\n'</span> + data.toString() +                <span class="hljs-string">'&#125;'</span>;    &#125;&#125;&lt;!--code￼<span class="hljs-number">5</span>--&gt;</code></pre></li><li><p><strong>注意：在使用了generator插件后，Mapper层不需要我们自己写了，相应地，当我们在Service层调用的Mapper的方法也会有所改变，其方法参数大多就是一pojoExample实例</strong></p></li></ul><h2 id="43-统一响应类"><a class="markdownIt-Anchor" href="#43-统一响应类"></a> 4.3 统一响应类</h2><ul><li>创建Resq包</li><li>下面放的是pojoResq类</li><li>进而Service层需要改动</li><li>方法参数变为PojoResq</li><li>在通过Mapper得到初始返回数据后，</li><li>利用BeanUtils的copy方法给pojoResq类赋值，最后Result类返回最终结果</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result&lt;List&lt;EbookResp&gt;&gt;list(EbookRequestParams ebookRequestParams) &#123;<br>    <span class="hljs-type">EbookExample</span> <span class="hljs-variable">ebookExample</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EbookExample</span>();<br>    EbookExample.<span class="hljs-type">Criteria</span> <span class="hljs-variable">criteria</span> <span class="hljs-operator">=</span> ebookExample.createCriteria();<br>    criteria.andNameLike(<span class="hljs-string">&quot;%&quot;</span>+ebookRequestParams.getName()+<span class="hljs-string">&quot;%&quot;</span>);<br>    criteria.andIdEqualTo(ebookRequestParams.getId());<br>    List&lt;Ebook&gt; ebookList = ebookMapper.selectByExample(ebookExample);<br>    List&lt;EbookResp&gt; list  = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    ebookList.forEach(ebook -&gt; &#123;<br>        <span class="hljs-type">EbookResp</span> <span class="hljs-variable">ebookResp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EbookResp</span>();<br>        BeanUtils.copyProperties(ebook,ebookResp);<br>        list.add(ebookResp);<br>    &#125;);<br>    <span class="hljs-keyword">return</span> Result.success(list,<span class="hljs-string">&quot;ok&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="44-copy工具类"><a class="markdownIt-Anchor" href="#44-copy工具类"></a> 4.4 copy工具类</h2><ul><li><p>泛型与反射知识</p></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">package</span> com.jyx.Utils;<span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<span class="hljs-keyword">import</span> java.util.ArrayList;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CopyUtil</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">copy</span><span class="hljs-params">(Object source ,Class&lt;T&gt; target)</span></span>&#123;        <span class="hljs-keyword">if</span>(source==<span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;        &#125;        T obj = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            obj = target.newInstance();            BeanUtils.copyProperties(source,obj);        &#125; <span class="hljs-keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> obj;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T,E&gt; <span class="hljs-function">List&lt;T&gt;  <span class="hljs-title">copyList</span><span class="hljs-params">(List&lt;E&gt; source,Class&lt;T&gt; target)</span></span>&#123;        List&lt;T&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-keyword">if</span>(!source.isEmpty()) &#123;            source.forEach(obj -&gt; &#123;                T temp = copy(obj, target);                list.add(temp);            &#125;);        &#125;        <span class="hljs-keyword">return</span> list;    &#125;&#125;&lt;!--code￼<span class="hljs-number">7</span>--&gt;</code></pre></li></ul><h2 id="51-集成antdesign-vue"><a class="markdownIt-Anchor" href="#51-集成antdesign-vue"></a> 5.1 集成Ant—Design-vue</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> Antd from <span class="hljs-string">&quot;ant-design-vue&quot;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;ant-design-vue/dist/antd.css&#x27;</span><br>createApp(App).use(store).use(router).use(Antd).mount(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="52自定义组件"><a class="markdownIt-Anchor" href="#52自定义组件"></a> 5.2自定义组件</h2><ul><li><p>组件</p></li><li><pre class="highlight"><code class="java">&lt;template&gt;  &lt;a-layout-footer style=<span class="hljs-string">"text-align: center"</span>&gt;    Ant Design ©<span class="hljs-number">2018</span> Created by Ant UED  &lt;/a-layout-footer&gt;&lt;/template&gt;&lt;script lang=<span class="hljs-string">"ts"</span>&gt;<span class="hljs-keyword">import</span> &#123; defineComponent &#125; from <span class="hljs-string">'vue'</span>;<span class="hljs-function">export <span class="hljs-keyword">default</span> <span class="hljs-title">defineComponent</span><span class="hljs-params">(&#123;  name: <span class="hljs-string">'TheFooter'</span>,  props: &#123;    msg: String,  &#125;,&#125;)</span></span>;&lt;/script&gt;&lt;style scoped&gt;&lt;/style&gt;&lt;!--code￼<span class="hljs-number">9</span>--&gt;</code></pre></li></ul><h1 id="6-前后端交互整合"><a class="markdownIt-Anchor" href="#6-前后端交互整合"></a> 6、前后端交互整合</h1><h2 id="60-集成http库axios"><a class="markdownIt-Anchor" href="#60-集成http库axios"></a> 6.0 集成HTTP库Axios</h2><p><strong>使用npm安装,在vue项目路径下</strong></p><p><code>npm install axios@0.21.0 --save</code></p><h2 id="61电子书前后端接口"><a class="markdownIt-Anchor" href="#61电子书前后端接口"></a> 6.1电子书前后端接口</h2><h3 id="跨域问题的解决"><a class="markdownIt-Anchor" href="#跨域问题的解决"></a> 跨域问题的解决</h3><ul><li><p>在Config包下新建CrosConfig类</p></li><li><p>记得添加@Cinfiguration</p></li><li><p>去实现WebMvcConfigurer</p></li><li><pre class="highlight"><code class="java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> </span>&#123;    registry.addMapping(<span class="hljs-string">"/**"</span>)            .allowedOriginPatterns(<span class="hljs-string">"*"</span>)            .allowedHeaders(CorsConfiguration.ALL)            .allowedMethods(CorsConfiguration.ALL)            .allowCredentials(<span class="hljs-keyword">true</span>)     &lt;!--code￼<span class="hljs-number">10</span>--&gt;</code></pre></li></ul><h2 id="64-查询电子书并且在页面展示"><a class="markdownIt-Anchor" href="#64-查询电子书并且在页面展示"></a> 6.4 查询电子书并且在页面展示</h2><p><strong>技术点</strong></p><h3 id="一-使用ref返回单个相应变量数据"><a class="markdownIt-Anchor" href="#一-使用ref返回单个相应变量数据"></a> 一、<strong>使用ref返回单个相应变量数据</strong></h3><p><strong>该方法的特点是：你给我什么我就拿到什么，也就是你要提前把这个数据封装成想要的结构</strong></p><ul><li>ref响应式数据类型</li><li>导入 ref包</li><li>在setup中声明 const ebooks = ref()</li><li>在onMounted 中</li><li>ebooks.value = data.data</li><li>在setup方法结尾处返回ebooks <strong>此时，要注意！！！！！！！</strong></li><li><strong>返回数据的写法为：</strong><code>return&#123;ebooks&#125;</code></li><li><strong>并且再次注意！！</strong></li><li>页面拿到数据的方式为：<code>&#123;&#123;ebooks&#125;&#125;</code></li><li>可以用<code>&lt;pre&gt;&lt;/pre&gt;</code>标签美化</li></ul><h3 id="二-使用reactive"><a class="markdownIt-Anchor" href="#二-使用reactive"></a> 二、使用reactive()</h3><p><strong>该方法的特点是，()里面要设置参数，并且这个参数应该是Json类型的，好处是在声明变量的时候就确定了所要传输数据的结构，value也可以是个对象（比如也是一个Json）！！即:<code>&#123;key0: value,key1:value....&#125;</code>  value 写成 <code>[]</code>，就表明这是一个数组</strong></p><ul><li>导入<code>reactive</code></li><li>在setup中声明变量 `const ebook = reactive({…})</li></ul><h3 id="三-代码"><a class="markdownIt-Anchor" href="#三-代码"></a> 三、代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">setup()&#123;<br>  console.log(<span class="hljs-string">&#x27;setup&#x27;</span>);<br>  <span class="hljs-type">const</span> <span class="hljs-variable">ebooks</span> <span class="hljs-operator">=</span> ref();<br>  <span class="hljs-type">const</span> <span class="hljs-variable">ebook</span> <span class="hljs-operator">=</span> reactive(&#123;book :[],code: <span class="hljs-string">&quot;&quot;</span>,msg:<span class="hljs-string">&quot;&quot;</span>&#125;)<br><br>  onMounted(()=&gt;&#123;<br>    console.log(<span class="hljs-string">&quot;onMounted&quot;</span>);<br>    axios.get(<span class="hljs-string">&#x27;http://localhost:8081/Test1?name=教程&#x27;</span>).then((response)=&gt;&#123;<br>      <span class="hljs-type">const</span>  <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> response.data;<br>      console.log(data);<br>      ebooks.value = data.data;<br>      ebook.book = data.data;<br>      ebook.msg = data.message;<br>      ebook.code = data.code;<br>    &#125;);<br>  &#125;)<br>  <span class="hljs-keyword">return</span>&#123;<br>    ebooks,<br>    ebook<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="65-导入图标库"><a class="markdownIt-Anchor" href="#65-导入图标库"></a> 6.5 导入图标库</h2><ul><li><p><strong>`npm install @ant-design/icons -vue --save</strong></p></li><li><p>在main.ts中写入</p></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">import</span> * as Icons from <span class="hljs-string">'@ant-design/icons-vue'</span>;<span class="hljs-keyword">const</span> incos : ant = Icons;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> i in incos)&#123;    App.compoent(i,incos[i]);&#125;&lt;!--code￼<span class="hljs-number">12</span>--&gt;</code></pre></li></ul><p>如果传进来值就按照传的值处理，要是没穿，则就是查询所有字段</p><h2 id="68-vue_cle多环境配置"><a class="markdownIt-Anchor" href="#68-vue_cle多环境配置"></a> 6.8 Vue_Cle多环境配置</h2><ul><li><p>在web目录下建立</p></li><li><p>.env.dev.txt</p></li><li><pre class="highlight"><code class="xml">NODE_ENV=developmentVUE_APP_SERVER=http://192.168.110.179:8081<span class="hljs-comment"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>- .env.prod.txt<br><br>- ```xml<br>  NODE_ENV=production<br>  VUE_APP_SERVER=http://jyx...<br></code></pre></td></tr></table></figure></span></code></pre></li><li><p>更改package.json 中的server名字</p></li><li><p>在main.js中配置全局变量</p></li><li><p><code>axios.defaults.baseURL = process.env.VUE_APP_SERVER</code></p></li></ul><h2 id="69-axios拦截器打印日志"><a class="markdownIt-Anchor" href="#69-axios拦截器打印日志"></a> 6.9 axios拦截器打印日志</h2><p><strong>在main.ts中加入</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs vue">axios.interceptors.request.use((config)=&gt;&#123;<br>    console.log(&#x27;请求参数：&#x27;,config);<br>    return config;<br>&#125;, error =&gt; &#123;<br>    return Promise.reject(error);<br>&#125;);<br>axios.interceptors.response.use((response)=&gt;&#123;<br>    console.log(&#x27;返回结果&#x27;,response);<br>    return response;<br>&#125;, error =&gt; &#123;<br>    return Promise.reject(error);<br>&#125;)<br><br>const app =  createApp(App);<br>app.use(store).use(router).use(Antd).mount(&#x27;#app&#x27;);<br>const icons : any = Icons;<br>for(const i in icons)&#123;<br>    app.component(i,icons[i]);<br>&#125;<br>console.log(process.env.NODE_ENV);<br>console.log(process.env.VUE_APP_SERVER);<br></code></pre></td></tr></table></figure><h2 id="610-servlet-的filter-检测接口耗时"><a class="markdownIt-Anchor" href="#610-servlet-的filter-检测接口耗时"></a> 6.10 Servlet 的Filter 检测接口耗时</h2><ul><li><p>新建filter包</p></li><li><p>新建LogFilter类</p></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">package</span> com.jyx.filter;<span class="hljs-keyword">import</span> com.mysql.cj.log.Log;<span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> javax.servlet.*;<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Filter</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOG =  LoggerFactory.getLogger(LogFilter<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException </span>&#123;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException </span>&#123;        <span class="hljs-comment">//打印请求信息</span>        HttpServletRequest request1 = (HttpServletRequest) request;        LOG.info(<span class="hljs-string">"----------LogFilter开始-----------"</span>);        LOG.info(<span class="hljs-string">"请求地址:&#123;&#125; &#123;&#125;"</span>,request1.getRequestURL().toString(),request1.getMethod());        LOG.info(<span class="hljs-string">"请求远程地址:&#123;&#125;"</span>,request1.getRemoteAddr());        <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();        chain.doFilter(request,response);        LOG.info(<span class="hljs-string">"------LogFilter结束：耗时&#123;&#125;ms"</span>,System.currentTimeMillis()-startTime);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span> </span>&#123;        Filter.<span class="hljs-keyword">super</span>.destroy();    &#125;&#125;&lt;!--code￼<span class="hljs-number">15</span>--&gt;</code></pre></li></ul><h2 id="71-使用spring-特有的-拦截器-interceptor-第二开始"><a class="markdownIt-Anchor" href="#71-使用spring-特有的-拦截器-interceptor-第二开始"></a> 7.1 使用Spring 特有的 拦截器 interceptor  第二开始</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jyx.interceptor;<br><br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 拦截器：Spring框架特有的，常用于登录校验，权限校验，请求日志打印 /login</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(LogInterceptor.class);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 打印请求信息</span><br>        LOG.info(<span class="hljs-string">&quot;------------- LogInterceptor 开始 -------------&quot;</span>);<br>        LOG.info(<span class="hljs-string">&quot;请求地址: &#123;&#125; &#123;&#125;&quot;</span>, request.getRequestURL().toString(), request.getMethod());<br>        LOG.info(<span class="hljs-string">&quot;远程地址: &#123;&#125;&quot;</span>, request.getRemoteAddr());<br><br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        request.setAttribute(<span class="hljs-string">&quot;requestStartTime&quot;</span>, startTime);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> (Long) request.getAttribute(<span class="hljs-string">&quot;requestStartTime&quot;</span>);<br>        LOG.info(<span class="hljs-string">&quot;------------- LogInterceptor 结束 耗时：&#123;&#125; ms -------------&quot;</span>, System.currentTimeMillis() - startTime);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="72-aop"><a class="markdownIt-Anchor" href="#72-aop"></a> 7.2 AOP  。。。。</h2><h2 id="73-打印sql日志"><a class="markdownIt-Anchor" href="#73-打印sql日志"></a> 7.3 打印sql日志</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.jyx.mapper:</span> <span class="hljs-string">trace</span><br></code></pre></td></tr></table></figure><h1 id="8-管理员页面"><a class="markdownIt-Anchor" href="#8-管理员页面"></a> 8、管理员页面</h1><h2 id="80-初始化"><a class="markdownIt-Anchor" href="#80-初始化"></a> 8.0 初始化</h2><ul><li><p><strong>添加一个页面后第一件事：添加路由</strong></p></li><li><pre class="highlight"><code class="java">,&#123;  path: <span class="hljs-string">'/admin/ebooks'</span>,  name: <span class="hljs-string">'ebookAdmin'</span>,  <span class="hljs-comment">// route level code-splitting</span>  <span class="hljs-comment">// this generates a separate chunk (about.[hash].js) for this route</span>  <span class="hljs-comment">// which is lazy-loaded when the route is visited.</span>  component: ebooksAdmin&#125;&lt;!--code￼<span class="hljs-number">18</span>--&gt;</code></pre></li></ul><h2 id="81-普通日志"><a class="markdownIt-Anchor" href="#81-普通日志"></a> 8.1 普通日志</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(EbookService.class);<br></code></pre></td></tr></table></figure><h2 id="82pagehelper的使用"><a class="markdownIt-Anchor" href="#82pagehelper的使用"></a> 8.2PageHelper的使用</h2><ul><li><p>添加依赖</p></li><li><pre class="highlight"><code class="java">&lt;dependency&gt;   &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;   &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt;   &lt;version&gt;<span class="hljs-number">1.4</span><span class="hljs-number">.2</span>&lt;/version&gt;&lt;/dependency&gt;&lt;!--code￼<span class="hljs-number">20</span>--&gt;</code></pre></li></ul><p><strong>其中，title为显示的字段名，dataIndex为a-table中datasource中每一个Json类型数据中的key值，要对应起来，否则每一列下的value不能正确显示</strong></p><h3 id="2-编辑按钮"><a class="markdownIt-Anchor" href="#2-编辑按钮"></a> 2、编辑按钮</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;a-button type=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-meta">@click</span>=<span class="hljs-string">&quot;edit(record)&quot;</span>&gt;<br>  编辑<br>&lt;/a-button&gt;<br></code></pre></td></tr></table></figure><h3 id="3-点击编辑按钮出现的表单"><a class="markdownIt-Anchor" href="#3-点击编辑按钮出现的表单"></a> 3、点击编辑按钮出现的表单</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;!-- 在编辑页面展示的电子书表单  --&gt;<br>    &lt;a-form :model=<span class="hljs-string">&quot;ebook&quot;</span> :label-col=<span class="hljs-string">&quot;&#123; span: 6 &#125;&quot;</span> :wrapper-col=<span class="hljs-string">&quot;&#123; span: 18 &#125;&quot;</span>&gt;<br>      &lt;a-form-item label=<span class="hljs-string">&quot;封面&quot;</span>&gt;<br>        &lt;a-input v-model:value=<span class="hljs-string">&quot;ebook.cover&quot;</span> /&gt;<br>      &lt;/a-form-item&gt;<br>      &lt;a-form-item label=<span class="hljs-string">&quot;名称&quot;</span>&gt;<br>        &lt;a-input v-model:value=<span class="hljs-string">&quot;ebook.name&quot;</span> /&gt;<br>      &lt;/a-form-item&gt;<br>      &lt;a-form-item label=<span class="hljs-string">&quot;分类1&quot;</span>&gt;<br>        &lt;a-input v-model:value=<span class="hljs-string">&quot;ebook.category1Id&quot;</span> /&gt;<br>      &lt;/a-form-item&gt;<br>      &lt;a-form-item label=<span class="hljs-string">&quot;分类2&quot;</span>&gt;<br>        &lt;a-input v-model:value=<span class="hljs-string">&quot;ebook.category2Id&quot;</span> /&gt;<br>      &lt;/a-form-item&gt;<br>      &lt;a-form-item label=<span class="hljs-string">&quot;描述&quot;</span>&gt;<br>        &lt;a-input v-model:value=<span class="hljs-string">&quot;ebook.description&quot;</span> type=<span class="hljs-string">&quot;textarea&quot;</span> /&gt;<br>      &lt;/a-form-item&gt;<br>    &lt;/a-form&gt;<br><br>  &lt;/a-modal&gt;<br></code></pre></td></tr></table></figure><h3 id="4-给予表单数据的"><a class="markdownIt-Anchor" href="#4-给予表单数据的"></a> 4、给予表单数据的</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">const</span> <span class="hljs-variable">ebook</span> <span class="hljs-operator">=</span> ref(&#123;&#125;);<br>    <span class="hljs-type">const</span> <span class="hljs-variable">modalVisible</span> <span class="hljs-operator">=</span> ref(<span class="hljs-literal">false</span>);<br>    <span class="hljs-type">const</span> <span class="hljs-variable">modalLoading</span> <span class="hljs-operator">=</span> ref(<span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure><h3 id="5-edit主方法"><a class="markdownIt-Anchor" href="#5-edit主方法"></a> 5 edit主方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">const</span> <span class="hljs-variable">edit</span> <span class="hljs-operator">=</span>(record:any)=&gt;&#123;<br>  ebook.value = record;<br>  modalVisible.value=<span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-点击ok请求更新数据刷新列表"><a class="markdownIt-Anchor" href="#6-点击ok请求更新数据刷新列表"></a> 6、点击ok，请求更新数据，刷新列表</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">const</span> <span class="hljs-variable">handleModalOk</span> <span class="hljs-operator">=</span> () =&gt;&#123;<br>  modalLoading.value = <span class="hljs-literal">true</span>;<br>  axios.post(<span class="hljs-string">&#x27;/ebook/save&#x27;</span>,ebook.value).then((response) =&gt; &#123;<br>    modalLoading.value = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">if</span> (response.data.code==<span class="hljs-number">1</span>)&#123;<br>      modalVisible.value = <span class="hljs-literal">false</span>;<br><br>      <span class="hljs-comment">// 重新加载列表</span><br>      handleQuery(&#123;<br>        page: pagination.value.current,<br>        size: pagination.value.pageSize,<br>      &#125;);<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>      message.error(response.data.message);<br>    &#125;<br>  &#125;)<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="7-保存操作的后端"><a class="markdownIt-Anchor" href="#7-保存操作的后端"></a> 7、保存操作的后端</h3><ul><li>根据id是否为null来决定是新增还是保存</li><li>新增和保存公用一个方法</li><li>Controller层 在接收前端传来的表达数据时候</li><li>要在参数前加上@ResponseBody注解，来保证接收到</li></ul><h2 id="84-雪花算法"><a class="markdownIt-Anchor" href="#84-雪花算法"></a> 8.4 雪花算法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jyx.Utils;<br><br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> java.text.ParseException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Twitter的分布式自增ID雪花算法</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnowFlake</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 起始的时间戳</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">START_STMP</span> <span class="hljs-operator">=</span>   <span class="hljs-number">1653580800000L</span>; <span class="hljs-comment">// 2021-01-01 08:00:00   起始时间</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 每一部分占用的位数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">SEQUENCE_BIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">12</span>; <span class="hljs-comment">//序列号占用的位数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">MACHINE_BIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;   <span class="hljs-comment">//机器标识占用的位数 2^5=32  最多可以表示32台机器</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">DATACENTER_BIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<span class="hljs-comment">//数据中心占用的位数</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 每一部分的最大值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_DATACENTER_NUM</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; DATACENTER_BIT);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_MACHINE_NUM</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; MACHINE_BIT);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_SEQUENCE</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; SEQUENCE_BIT);<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 每一部分向左的位移</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">MACHINE_LEFT</span> <span class="hljs-operator">=</span> SEQUENCE_BIT;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">DATACENTER_LEFT</span> <span class="hljs-operator">=</span> SEQUENCE_BIT + MACHINE_BIT;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">TIMESTMP_LEFT</span> <span class="hljs-operator">=</span> DATACENTER_LEFT + DATACENTER_BIT;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">datacenterId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">//数据中心</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">machineId</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;     <span class="hljs-comment">//机器标识</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">sequence</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>; <span class="hljs-comment">//序列号</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">lastStmp</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1L</span>;<span class="hljs-comment">//上一次时间戳</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SnowFlake</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SnowFlake</span><span class="hljs-params">(<span class="hljs-type">long</span> datacenterId, <span class="hljs-type">long</span> machineId)</span> &#123;<br>        <span class="hljs-keyword">if</span> (datacenterId &gt; MAX_DATACENTER_NUM || datacenterId &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;datacenterId can&#x27;t be greater than MAX_DATACENTER_NUM or less than 0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (machineId &gt; MAX_MACHINE_NUM || machineId &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;machineId can&#x27;t be greater than MAX_MACHINE_NUM or less than 0&quot;</span>);<br>        &#125;<br>        <span class="hljs-built_in">this</span>.datacenterId = datacenterId;<br>        <span class="hljs-built_in">this</span>.machineId = machineId;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 产生下一个ID</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nextId</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">currStmp</span> <span class="hljs-operator">=</span> getNewstmp();<span class="hljs-comment">//这个是跟起始时间戳的一个差值</span><br>        <span class="hljs-keyword">if</span> (currStmp &lt; lastStmp) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Clock moved backwards.  Refusing to generate id&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (currStmp == lastStmp) &#123;<br>            <span class="hljs-comment">//相同毫秒内，序列号自增</span><br>            sequence = (sequence + <span class="hljs-number">1</span>) &amp; MAX_SEQUENCE;  <span class="hljs-comment">//一个毫秒内，最多可以生成的序列号是 2^SEQUENCE_BIT</span><br>            <span class="hljs-comment">//同一毫秒的序列数已经达到最大</span><br>            <span class="hljs-keyword">if</span> (sequence == <span class="hljs-number">0L</span>) &#123;<br>                currStmp = getNextMill();<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//不同毫秒内，序列号置为0</span><br>            sequence = <span class="hljs-number">0L</span>;<br>        &#125;<br><br>        lastStmp = currStmp;<br><br>        <span class="hljs-keyword">return</span> (currStmp - START_STMP) &lt;&lt; TIMESTMP_LEFT <span class="hljs-comment">//时间戳部分</span><br>                | datacenterId &lt;&lt; DATACENTER_LEFT       <span class="hljs-comment">//数据中心部分</span><br>                | machineId &lt;&lt; MACHINE_LEFT             <span class="hljs-comment">//机器标识部分</span><br>                | sequence;                             <span class="hljs-comment">//序列号部分</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getNextMill</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">mill</span> <span class="hljs-operator">=</span> getNewstmp();<br>        <span class="hljs-keyword">while</span> (mill &lt;= lastStmp) &#123;<br>            mill = getNewstmp();<br>        &#125;<br>        <span class="hljs-keyword">return</span> mill;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getNewstmp</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> System.currentTimeMillis();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ParseException &#123;<br>        <span class="hljs-comment">// 时间戳</span><br><span class="hljs-comment">//         System.out.println(System.currentTimeMillis());</span><br><span class="hljs-comment">//         System.out.println(new Date().getTime());</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//         String dateTime = &quot;2022-05-27 00:00:00&quot;;</span><br><span class="hljs-comment">//         SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd hh:mm:ss&quot;);</span><br><span class="hljs-comment">//         System.out.println(sdf.parse(dateTime).getTime());</span><br><br>        <span class="hljs-type">SnowFlake</span> <span class="hljs-variable">snowFlake</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SnowFlake</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            System.out.println(snowFlake.nextId());<span class="hljs-comment">//每次都去生成id</span><br>            System.out.println(System.currentTimeMillis() - start);<span class="hljs-comment">//计算生成所耗费的时间</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="85-删除功能"><a class="markdownIt-Anchor" href="#85-删除功能"></a> 8.5 删除功能</h2><ul><li>前端</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;a-popconfirm<br>    title=<span class="hljs-string">&quot;Are you sure delete this task?&quot;</span><br>    ok-text=<span class="hljs-string">&quot;Yes&quot;</span><br>    cancel-text=<span class="hljs-string">&quot;No&quot;</span><br>    <span class="hljs-meta">@confirm</span>=<span class="hljs-string">&quot;handleDelete(record.id)&quot;</span><br>&gt;<br>  &lt;a-button type=<span class="hljs-string">&quot;danger&quot;</span>&gt;<br>    删除<br>  &lt;/a-button&gt;<br>&lt;/a-popconfirm&gt;<br></code></pre></td></tr></table></figure><h2 id="86-查询功能"><a class="markdownIt-Anchor" href="#86-查询功能"></a> 8.6 查询功能</h2><ul><li>横向的form表单</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;p&gt;<br>  &lt;a-form layout=<span class="hljs-string">&quot;inline&quot;</span> :model=<span class="hljs-string">&quot;param&quot;</span>&gt;<br>    &lt;a-form-item&gt;<br>      &lt;a-input v-model:value=<span class="hljs-string">&quot;param.name&quot;</span> placeholder=<span class="hljs-string">&quot;名称&quot;</span>&gt;&lt;/a-input&gt;<br>    &lt;/a-form-item&gt;<br>    &lt;a-form-item&gt;<br>      &lt;a-button type=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-meta">@click</span>=<span class="hljs-string">&quot;handleQuery(&#123;page: 1, size: pagination.pageSize&#125;)&quot;</span>&gt;<br>        查询<br>      &lt;/a-button&gt;<br>    &lt;/a-form-item&gt;<br>    &lt;a-form-item&gt;<br>      &lt;a-button type=<span class="hljs-string">&quot;primary&quot;</span> <span class="hljs-meta">@click</span>=<span class="hljs-string">&quot;add()&quot;</span>&gt;<br>        新增<br>      &lt;/a-button&gt;<br>    &lt;/a-form-item&gt;<br>  &lt;/a-form&gt;<br>&lt;/p&gt;<br></code></pre></td></tr></table></figure><ul><li>param为响应式数据变量 其值从input获得</li><li>注意此处 并没有在 查询按钮的@Click绑定的函数中直接给到 查询参数name 的值 而是在setup函数中 定义param变量</li><li><strong>重点：定义完之后一定要初始化！！！</strong></li><li>在查询函数中再去 添加 传给后端的参数</li><li>最后要在setup 后 return 回去</li></ul><h2 id="87-axios异步加载可能出现的问题"><a class="markdownIt-Anchor" href="#87-axios异步加载可能出现的问题"></a> 8.7 axios异步加载可能出现的问题</h2><ul><li><p>如果分类查询在书籍查询之后</p></li><li><p>并且书籍中要用到书籍分类的数据</p></li><li><p>则会报错。  书籍展示–&gt;(依赖于)分类数据</p></li><li><p>应该在axios中将查询内置在分类查询中，</p></li><li><pre class="highlight"><code class="Java"><span class="hljs-comment">/** * 查询所有分类 **/</span><span class="hljs-keyword">const</span> handleQueryCategory = () =&gt; &#123;  loading.value = <span class="hljs-keyword">true</span>;  axios.get(<span class="hljs-string">"/category/all"</span>).then((response) =&gt; &#123;    loading.value = <span class="hljs-keyword">false</span>;    <span class="hljs-keyword">const</span> data = response.data;    <span class="hljs-keyword">if</span> (data.code==<span class="hljs-number">1</span>) &#123;      categorys = data.data;      console.log(<span class="hljs-string">"原始数组："</span>, categorys);      level1.value = [];      level1.value = Tool.array2Tree(categorys, <span class="hljs-number">0</span>);      console.log(<span class="hljs-string">"树形结构："</span>, level1.value);      <span class="hljs-comment">// 加载完分类，再加载电子书，否则如果分类树加载很慢，则电子书渲染会报错</span>      <span class="hljs-comment">//因为axios异步加载的原因</span>      handleQuery(&#123;        page: <span class="hljs-number">1</span>,        size: pagination.value.pageSize      &#125;);    &#125; <span class="hljs-keyword">else</span> &#123;      message.error(data.message);    &#125;  &#125;);&#125;;&lt;!--code￼<span class="hljs-number">29</span>--&gt;</code></pre></li></ul><p><strong>渲染数据</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;template v-slot:category=<span class="hljs-string">&quot;&#123; text, record &#125;&quot;</span>&gt;<br>  &lt;span&gt;&#123;&#123; queryCategoryName(record.category1Id) &#125;&#125; / &#123;&#123;queryCategoryName(record.category2Id) &#125;&#125;&lt;/span&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;<br>  title: <span class="hljs-string">&#x27;分类&#x27;</span>,<br><br>  slots: &#123; customRender: <span class="hljs-string">&#x27;category&#x27;</span> &#125;<br>&#125;,<br></code></pre></td></tr></table></figure><h1 id="9-文档管理"><a class="markdownIt-Anchor" href="#9-文档管理"></a> 9、文档管理</h1><h2 id="90-vue中的route-link标签中url设置参数"><a class="markdownIt-Anchor" href="#90-vue中的route-link标签中url设置参数"></a> 9.0 vue中的route-link标签中url设置参数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;router-link :to=<span class="hljs-string">&quot;&#x27;/admin/doc?ebookId=&#x27; + record.id&quot;</span>&gt;<br></code></pre></td></tr></table></figure><ul><li><code>''</code>中给出的为字符串，以<code>+</code>方式拼接</li></ul><p>被跳转的页面中 <strong>使用useRoute()拿到参数</strong></p><ul><li><code>const route = useRoute();</code></li><li></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">doc.value = &#123;<br>  ebookId: route.query.ebookId,<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="91-文档内容的保存saveoradd-的逻辑以及copyutils的注意问题不能有构造器"><a class="markdownIt-Anchor" href="#91-文档内容的保存saveoradd-的逻辑以及copyutils的注意问题不能有构造器"></a> 9.1 文档内容的保存(saveOrAdd 的逻辑，以及CopyUtils的注意问题，不能有构造器)</h2><h3 id="一-saveoradd-的逻辑"><a class="markdownIt-Anchor" href="#一-saveoradd-的逻辑"></a> 一、<strong>SaveOrAdd</strong> 的逻辑</h3><p><strong>主要思路</strong>:1,对新增的文档而言:文档内容（实际是Content表）一定是 Add操作</p><p>​   2，对要Save（即已经创建过的文档）的文档而言，依据：**Content中对应文档ID的content字段是否为空（具体判断的依据是：update的返回值）**分两种情况</p><p>I:<strong>update</strong>的返回值若为0，则表示并<strong>无</strong>docId对应的字段，还不存在，update当然返回值为0，此时就应该去<strong>insert</strong></p><p>II: <strong>update</strong>的返回值若为1,则与<strong>I</strong>相反，则不需要另外的操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(DocSaveReq req)</span>&#123;<br>    <span class="hljs-type">Doc</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> CopyUtil.copy(req,Doc.class);<br>    <span class="hljs-type">Content</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> CopyUtil.copy(req,Content.class);<br>    <span class="hljs-keyword">if</span>(ObjectUtils.isEmpty(req.getId()))&#123;<br>        <span class="hljs-comment">//新增</span><br>        doc.setId(snowFlake.nextId());<br>        doc.setViewCount(<span class="hljs-number">0</span>);<br>        doc.setVoteCount(<span class="hljs-number">0</span>);<br>        docMapper.insertSelective(doc);<br><br>        <span class="hljs-comment">//对content insert</span><br>        content.setId(doc.getId());<br>        contentMapper.insertSelective(content);<br>    &#125; <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">//更新</span><br>        docMapper.updateByPrimaryKey(doc);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> contentMapper.updateByPrimaryKeyWithBLOBs(content);<br>        <span class="hljs-comment">//返回值判断</span><br>        <span class="hljs-keyword">if</span>(count == <span class="hljs-number">0</span>)&#123;<br>            contentMapper.insert(content);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="二-copyutils的注意问题"><a class="markdownIt-Anchor" href="#二-copyutils的注意问题"></a> 二、CopyUtils的注意问题</h3><p><code>Doc doc = CopyUtil.copy(req,Doc.class);</code></p><p>如果req中有了全字段的构造器，这个时候手动地去再添加一个无参构造器，则报错，则会Copy失败。。。。</p><h2 id="92-阅读数加一点赞"><a class="markdownIt-Anchor" href="#92-阅读数加一点赞"></a> 9.2 阅读数加一&amp;点赞</h2><p><strong>注意的问题</strong></p><ol><li>尽管数据库中设置了view和vote的字段默认值为<strong>0</strong>,但如果是在insert的时候选择了这两个字段，则新增的一条数据的</li><li>解决办法：</li></ol><p><strong>未弄明白的问题</strong>:</p><p>（具体的在一段时间内同一ip的人不能对同一篇文章多次点赞）</p><p>RedisUtil , RequestContext,Aop</p><h2 id="93-修复-在不刷新的情况下在同一电子书页面内点击不同的文档页面来回跳转时阅读数不能实时更新的bug"><a class="markdownIt-Anchor" href="#93-修复-在不刷新的情况下在同一电子书页面内点击不同的文档页面来回跳转时阅读数不能实时更新的bug"></a> 9.3 修复 在不刷新的情况下在同一电子书页面内点击不同的文档，页面来回跳转时，阅读数不能实时更新的bug。</h2><h2 id="94-自定义sql更新ebookinfor"><a class="markdownIt-Anchor" href="#94-自定义sql更新ebookinfor"></a> 9.4 自定义sql更新ebookInfor</h2><h2 id="95-springboot定时任务"><a class="markdownIt-Anchor" href="#95-springboot定时任务"></a> 9.5 SpringBoot定时任务</h2><h2 id="96websocketmap修饰符问题"><a class="markdownIt-Anchor" href="#96websocketmap修饰符问题"></a> 9.6WebSocket,map修饰符问题</h2><h2 id="97-异步化中注解冲突问题"><a class="markdownIt-Anchor" href="#97-异步化中注解冲突问题"></a> 9.7 异步化中注解冲突问题</h2><h2 id="98-事务注解"><a class="markdownIt-Anchor" href="#98-事务注解"></a> 9.8 事务注解</h2><h1 id="10-user管理"><a class="markdownIt-Anchor" href="#10-user管理"></a> 10、User管理</h1><h2 id="100-生成user-的问题"><a class="markdownIt-Anchor" href="#100-生成user-的问题"></a> 10.0 生成User 的问题</h2><ul><li>Mybatis中generator在生成User时，Mapper类中没有 <strong>update</strong>方法</li><li>不可知的原因使得 表明 为 <strong>user</strong>的表生成代码文件不对</li><li>经过修改表名得以解决问题</li></ul><h2 id="101-业务异常统一处理类"><a class="markdownIt-Anchor" href="#101-业务异常统一处理类"></a> 10.1 业务异常统一处理类</h2><ul><li><p><strong>BusinessExceptionCode</strong></p></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">package</span> com.jyx.exception;<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> BusinessExceptionCode &#123;    USER_LOGIN_NAME_EXIST(<span class="hljs-string">"登录名已存在"</span>),    LOGIN_USER_ERROR(<span class="hljs-string">"用户名不存在或密码错误"</span>),    VOTE_REPEAT(<span class="hljs-string">"您已点赞过"</span>),    ;    ;    <span class="hljs-keyword">private</span> String desc;    BusinessExceptionCode() &#123;    &#125;    BusinessExceptionCode(String desc) &#123;        <span class="hljs-keyword">this</span>.desc = desc;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getDesc</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> desc;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDesc</span><span class="hljs-params">(String desc)</span> </span>&#123;        <span class="hljs-keyword">this</span>.desc = desc;    &#125;&#125;&lt;!--code￼<span class="hljs-number">35</span>--&gt;</code></pre></li><li><hr><p><strong>ControllerExceptionHandler</strong>中新增加</p></li><li><pre class="highlight"><code class="java"><span class="hljs-comment">/** * 业务异常统一处理 * */</span><span class="hljs-meta">@ExceptionHandler</span>(value = BusinessException<span class="hljs-class">.<span class="hljs-keyword">class</span>)@<span class="hljs-title">ResponseBody</span><span class="hljs-title">public</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">Object</span>&gt; <span class="hljs-title">validExceptionHandler</span>(<span class="hljs-title">BusinessException</span> <span class="hljs-title">e</span>) </span>&#123;    LOG.warn(<span class="hljs-string">"业务异常：&#123;&#125;"</span>, e.getCode().getDesc());    <span class="hljs-keyword">return</span> Result.error(Code.BUSINESS_EXCEPTION.getCode(),BusinessExceptionCode.USER_LOGIN_NAME_EXIST.getDesc());&#125;&lt;!--code￼<span class="hljs-number">36</span>--&gt;</code></pre></li></ul><h2 id="103-不可修改用户名前端"><a class="markdownIt-Anchor" href="#103-不可修改用户名前端"></a> 10.3 不可修改用户名（前端）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;a-input v-model:value=&quot;user.name&quot; :disabled=&quot;user.id!==undefined&quot; /&gt;<br></code></pre></td></tr></table></figure><p>**特别注意:      <code>:</code>   **千万不能  <strong>少！！！！</strong></p><h2 id="104-copyutils-的作用"><a class="markdownIt-Anchor" href="#104-copyutils-的作用"></a> 10.4 CopyUtils 的作用！！</h2><p><strong>重置密码需求分析:</strong></p><ul><li>前景：前端有密码格式校验，所以如果再编辑页面处理重置密码的需求，由于经过加密的密码长度为32位，就不符合了校验规则，导致每次想更改其他字段的时候，都不得不去修改加密过后的密码，并且要想维持原密码，每次还需要去输入原来的密码</li><li>如此编辑功能应该与重置密码功能解耦（此处应该是由于密码具有检验规则导致了这两个功能产生了复杂关系）</li></ul><p><strong>CopyUtils 的作用</strong></p><ul><li>由于mybatis的自动生成的代码中的方法参数类型基本都以domain中的原生实体类为主，</li><li>又因为在Service层中为了可拓展性的提高，Service方法的参数基本都是经过包装过的<strong>XXXReq</strong> 类，</li><li>因此不能直接将传到Service方法中的Req类型参数给到Mapper层，</li><li>因此就有了 要从<strong>Req类型</strong>转到<strong>原生类型</strong> 并且达到<strong>已有数据拷贝</strong>的需求，即<strong>CopUtils</strong></li></ul><h2 id="105-user登录页面"><a class="markdownIt-Anchor" href="#105-user登录页面"></a> 10.5 User登录页面</h2><h3 id="一-前端"><a class="markdownIt-Anchor" href="#一-前端"></a> 一、前端</h3><p><strong>主要思路：</strong></p><ol><li><p>添加登录的<code>&lt;a&gt;&lt;/a&gt;</code>标签，或者按钮，点击则会弹出 <strong>loginModel</strong>(即要去@Click一个函数);</p></li><li><p>loginModel 中应该有: 用户名，密码（要加密），代码：</p></li><li><pre class="highlight"><code class="vue">&lt;a-modal    title=&quot;登录&quot;    v-model:visible=&quot;loginModalVisible&quot;    :confirm-loading=&quot;loginModalLoading&quot;    @ok=&quot;login&quot;&gt;  &lt;a-form :model=&quot;loginUser&quot; :label-col=&quot;&#123; span: 6 &#125;&quot; :wrapper-col=&quot;&#123; span: 18 &#125;&quot;&gt;    &lt;a-form-item label=&quot;登录名&quot;&gt;      &lt;a-input v-model:value=&quot;loginUser.name&quot; /&gt;    &lt;/a-form-item&gt;    &lt;a-form-item label=&quot;密码&quot;&gt;      &lt;a-input v-model:value=&quot;loginUser.password&quot; type=&quot;password&quot; /&gt;    &lt;/a-form-item&gt;  &lt;/a-form&gt;&lt;/a-modal&gt;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"><br>4. loginModel 中涉及的变量，<br><br>5. ```typescript<br>   const loginModalVisible = ref(false);<br>   const loginModalLoading = ref(false);<br>   const loginUser = ref(&#123;<br>     name: &#x27;never&#x27;,<br>     password: &#x27;never&#x27;,<br>   &#125;)<br>   //loginUser 为一个响应式变量，会动态监听模态框中的字段值，更新到 loginModel中 form中 的 :model指定的变量 本例中就是 loginUser (:model=&quot;loginUser&quot; )<br></code></pre></td></tr></table></figure></code></pre></li><li><p>弹出model的函数：</p></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">const</span> showLoginModal = () =&gt; &#123;  loginModalVisible.value =<span class="hljs-keyword">true</span>;&#125;&lt;!--code￼<span class="hljs-number">39</span>--&gt;</code></pre></li></ol><h3 id="二-后端"><a class="markdownIt-Anchor" href="#二-后端"></a> 二、后端</h3><p><strong>就是增加一个接口，一个req，一个resp（这个resp在后面用于取到该用户的一些信息）</strong></p><p><strong>login接口</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> UserLoginResp <span class="hljs-title function_">login</span><span class="hljs-params">(UserLoginReq req)</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">userDb</span> <span class="hljs-operator">=</span> selectUserByName(req.getName());<br>    <span class="hljs-keyword">if</span> (ObjectUtils.isEmpty(userDb)) &#123;<br>        <span class="hljs-comment">//用户名不存在</span><br>        LOG.info(<span class="hljs-string">&quot;用户名不存在:&#123;&#125;&quot;</span>, req.getName());<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(BusinessExceptionCode.LOGIN_USER_ERROR);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!userDb.getPassword().equals(req.getPassword())) &#123;<br>        <span class="hljs-comment">//密码错误</span><br>        LOG.info(<span class="hljs-string">&quot;用户:&#123;&#125; 密码错误&quot;</span>, req.getName());<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(BusinessExceptionCode.LOGIN_USER_ERROR);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> CopyUtil.copy(userDb, UserLoginResp.class);<br>&#125;<br></code></pre></td></tr></table></figure><p>此处的注意点:</p><ul><li><p>当用户发生密码或者用户名错误的时候，Service方法不应该直接返回null</p></li><li><p>而是，因该去自定义一个<strong>BusinessException</strong>异常</p></li><li></li><li><pre class="highlight"><code class="java"><span class="hljs-keyword">package</span> com.jyx.exception;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BusinessException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;    BusinessExceptionCode code;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BusinessException</span><span class="hljs-params">(String message, BusinessExceptionCode code)</span> </span>&#123;        <span class="hljs-keyword">super</span>(message);        <span class="hljs-keyword">this</span>.code = code;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BusinessException</span><span class="hljs-params">()</span> </span>&#123;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BusinessException</span><span class="hljs-params">(BusinessExceptionCode code)</span> </span>&#123;        <span class="hljs-keyword">super</span>(code.getDesc());        <span class="hljs-keyword">this</span>.code = code;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> BusinessExceptionCode <span class="hljs-title">getCode</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> code;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCode</span><span class="hljs-params">(BusinessExceptionCode code)</span> </span>&#123;        <span class="hljs-keyword">this</span>.code = code;    &#125;    <span class="hljs-comment">/**     * 不写入堆栈信息，提高性能     */</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Throwable <span class="hljs-title">fillInStackTrace</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;    &#125;&#125;&lt;!--code￼<span class="hljs-number">41</span>--&gt;</code></pre></li><li><p><strong>ControllerExceptionHandler</strong></p></li><li><pre class="highlight"><code class="java"><span class="hljs-comment">/** * 业务异常统一处理 * */</span><span class="hljs-meta">@ExceptionHandler</span>(value = BusinessException<span class="hljs-class">.<span class="hljs-keyword">class</span>)@<span class="hljs-title">ResponseBody</span><span class="hljs-title">public</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">Object</span>&gt; <span class="hljs-title">validExceptionHandler</span>(<span class="hljs-title">BusinessException</span> <span class="hljs-title">e</span>) </span>&#123;    LOG.warn(<span class="hljs-string">"业务异常：&#123;&#125;"</span>, e.getCode().getDesc());    <span class="hljs-keyword">return</span> Result.error(Code.BUSINESS_EXCEPTION.getCode(),e.getCode().getDesc());&#125;&lt;!--code￼<span class="hljs-number">42</span>--&gt;</code></pre></li><li><p>定义一个全局的常量<code>USER</code>,它作为sessionStore中的一个储存user信息的K-V对，其Key为 USER，通过sessionStore.get()方法可以获取USER对应的Value，并将其赋值给state中<code>user</code>对应的value,(此处之所以要经过这样的一次中转，应该是为了便于维护，其他位置对store的操作更方便些，所以实质上user的信息因该是储存在sessionStore中，应该和Session道理类似)</p></li><li><p>mutations中定义的是对state的一些操作方法，</p></li><li><p>此处参数，state是必要的，user为Source，target为state中的user的value和sessionStore中的USER的value。</p></li><li><p>应该注意的是，state是一个json类型对象，其中定义一个user,其值从SessionStore.get方法动态获取，有两种情况：</p></li><li><p>1，最开始未登录的时候，sessionStore中USER的value并无值，因为在下面的login方法中才会调用**stor.commit(mehtodName,parameters)**方法去</p><p><code>state.user = user;</code><br><code>SessionStorage.set(USER,user);</code></p><p>所以才有了这一行代码的后半段<code>user:SessionStorage.get(USER)||&#123;&#125;,</code></p><p>赋一个空对象，防止null</p></li><li><p>登录后的刷新问题，</p></li><li><p>在登陆后，sessionStore的USER对应的Valu中就存有user的信息，value为一个json对象，在刷新页面后，<strong>USER仍然存在</strong>，这个时候，vue组件重新加载，以下代码</p></li><li><pre class="highlight"><code class="typescript">state: &#123;    user:SessionStorage.get(USER)||&#123;&#125;,  &#125;,&lt;!--code￼<span class="hljs-number">43</span>--&gt;</code></pre></li><li><p>computed 的方式 声明 user是一个响应式变量，user会从computed中的函数的返回值动态的更新数据，也就是说，use的值的变化取决于，函数值的变化，结果的功能上与ref()有点像，（个人理解就相当于是store.state.user的一个&quot;影分身&quot;）并且该变量最后要return出去，以便给到页面使用</p></li><li><p>登录的时候要</p></li><li><pre class="highlight"><code class="typescript">axios.post(<span class="hljs-string">'user/login'</span>,loginUser.value).then(<span class="hljs-function">(<span class="hljs-params">response</span>)=&gt;</span>&#123;  loginModalLoading.value = <span class="hljs-literal">false</span>;  <span class="hljs-keyword">const</span> data = response.data;  <span class="hljs-keyword">if</span>(data.code===<span class="hljs-number">1</span>)&#123;    message.success(<span class="hljs-string">"登录成功"</span>);    <span class="hljs-comment">//登录成功后将data里面的user信息存到 vuex 的 user 里面</span>    store.commit(<span class="hljs-string">"setUser"</span>,data.data);    loginModalVisible.value = <span class="hljs-literal">false</span>;  &#125;<span class="hljs-keyword">else</span> &#123;   message.error(data.message);  &#125;&#125;)&lt;!--code￼<span class="hljs-number">44</span>--&gt;</code></pre></li></ul><h1 id="11-项目发布"><a class="markdownIt-Anchor" href="#11-项目发布"></a> 11、项目发布</h1><h2 id="00-idea-连接云数据库"><a class="markdownIt-Anchor" href="#00-idea-连接云数据库"></a> 0.0 idea 连接云数据库</h2><h2 id="01-idea-连接云服务器"><a class="markdownIt-Anchor" href="#01-idea-连接云服务器"></a> 0.1 idea 连接云服务器</h2><h2 id="02-通过idea向服务器上传文件"><a class="markdownIt-Anchor" href="#02-通过idea向服务器上传文件"></a> 0.2 通过idea向服务器上传文件</h2>]]></content>
      
      
      <categories>
          
          <category> spring_boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式_语法学习_10_(嵌入条件)</title>
      <link href="/2022/04/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_10_(%E5%B5%8C%E5%85%A5%E6%9D%A1%E4%BB%B6)/"/>
      <url>/2022/04/15/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_10_(%E5%B5%8C%E5%85%A5%E6%9D%A1%E4%BB%B6)/</url>
      
        <content type="html"><![CDATA[<br><h1 id="一-回溯引用判断"><a class="markdownIt-Anchor" href="#一-回溯引用判断"></a> 一、回溯引用判断</h1><p><strong>到目前为止</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;?(匹配前一个字符，或者表达式，如果存在的话)&quot;</span><br><span class="hljs-string">&quot;?=(向前匹配，如果存在的话)&quot;</span><br><span class="hljs-string">&quot;?&lt;=（向后匹配，如果存在的话）&quot;</span><br></code></pre></td></tr></table></figure><p><strong>条件语句</strong>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">(?(backreference)<span class="hljs-literal">true</span>-reges)<br></code></pre></td></tr></table></figure><p><strong>例一</strong></p><p><strong>目的</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;需要把一段文本里的&lt;IMG&gt;标签全都找出来；不仅如此，如果某个&lt;IMG&gt;&quot;</span><br><span class="hljs-string">&quot;标签是一个链接（被括在&lt;A&gt;和&lt;/A&gt;标签之间）的话，你还要把整个链&quot;</span><br><span class="hljs-string">&quot;接标签匹配出来。&quot;</span><br></code></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/16/t4EUQvl573uXerO.png" alt="回溯引用条件语句"></p><p><strong>分析</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1</span>，所要匹配的文本中，&lt;img&gt;&lt;/img&gt;标签是无论如何都要求被匹配出的内容<br><span class="hljs-number">2</span>，&lt;A&gt;&lt;/A&gt;标签则成对出现，当且仅当有前者的时候，后者才可出现<br><span class="hljs-number">3</span>，因此条件语句的<span class="hljs-string">&quot;backreferencr&quot;</span>为<span class="hljs-string">&quot;(&lt;[Aa]\s+[^&gt;]+\s*)&gt;&quot;</span>,<br>此<span class="hljs-string">&quot;backreferencr&quot;</span>匹配&lt;A&gt;标签及其属性，<br>当且仅当它成功匹配时，其后的<span class="hljs-string">&quot;true-regex&quot;</span>即<span class="hljs-string">&quot;\s*\/[Aa]&gt;&quot;</span>才回去匹配<br></code></pre></td></tr></table></figure><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">判断<span class="hljs-string">&quot;backference&quot;</span>是否匹配成功的依据表达式（也就是回溯引用）<br>仅仅是指第几个子表达式(就是被括号包围住的式子)<br></code></pre></td></tr></table></figure><p><strong>(我的误区):</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;认为第一个子表达式其后紧跟的?也属于判断表达式&quot;</span><br><span class="hljs-string">&quot;然而事实上这个&quot;</span>?<span class="hljs-string">&quot;只是为了在任何情况下&quot;</span><br><span class="hljs-string">&quot;(即无所谓&quot;</span>backreference<span class="hljs-string">&quot;是否有成功匹配)&quot;</span><br><span class="hljs-string">&quot;它都会去执行后面&lt;IMG&gt;标签的匹配工作&quot;</span><br></code></pre></td></tr></table></figure><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;?(1)检查第一个回溯引用是否存在。在条件里，回溯引用编&quot;</span><br><span class="hljs-string">&quot;号（本例中的1）不需要被转义。因此，?(1)是正确的，&quot;</span><br><span class="hljs-string">&quot;?(\1)不正确（但后者通常也能工作）。&quot;</span><br></code></pre></td></tr></table></figure><p><strong>例二：“(?(backer- ference)true-regex|false-regex)”的应用</strong></p><p><strong>目的：匹配北美电话号码</strong></p><p><strong>background</strong>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">(<span class="hljs-number">123</span>)<span class="hljs-number">456</span>-<span class="hljs-number">7890</span>和<span class="hljs-number">123</span>-<span class="hljs-number">456</span>-<span class="hljs-number">7890</span>都是可接受的北美电话号码格式，<br>而<span class="hljs-number">1234567890</span>、(<span class="hljs-number">123</span>)-<span class="hljs-number">456</span>-<span class="hljs-number">7890</span>和(<span class="hljs-number">123</span>-<span class="hljs-number">456</span>-<span class="hljs-number">7890</span>)虽然都包含着数<br>目正确的数字字符，但它们的格式都不对。如果让你来编写一个正则表<br>达式并让它只匹配可接受的格式，不匹配其他格式，你会怎么做？<br></code></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/16/acOnfoUDhqsg8Hx.png" alt="ture-regex_and_flase-regex"></p><p><strong>分析</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;在此例中，可能会出现不同情况的符号组合为:&quot;</span><br><span class="hljs-string">&quot;1,有&quot;</span>(<span class="hljs-string">&quot;的时候，则必有&quot;</span>)<span class="hljs-string">&quot;,并且此时没有&quot;</span>-<span class="hljs-string">&quot; &quot;</span><br><span class="hljs-string">&quot;2,没有&quot;</span>(<span class="hljs-string">&quot;的时候，则必有&quot;</span>-<span class="hljs-string">&quot;,并且此时没有&quot;</span>)<span class="hljs-string">&quot; &quot;</span><br><span class="hljs-string">&quot;因此被判断的回溯引用为:(\())&quot;</span><br></code></pre></td></tr></table></figure><h2 id="二-前后查找条件"><a class="markdownIt-Anchor" href="#二-前后查找条件"></a> 二、前后查找条件</h2><p><strong>目的：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">作为一个例子，请你思考一下怎样匹配美国的邮政编码（简称ZIP编<br>码）。美国邮政编码有两种格式，一种是<span class="hljs-number">12345</span>形式的ZIP格式，另一<br>种是<span class="hljs-number">12345</span>-<span class="hljs-number">6789</span>形式的ZIP+<span class="hljs-number">4</span>格式。只有ZIP+<span class="hljs-number">4</span>格式才必须使用连字符<br>来分隔前<span class="hljs-number">5</span>位和后<span class="hljs-number">4</span>位数字。<br></code></pre></td></tr></table></figure><p><strong>分析</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;此例中，前五位数字是必须的，&quot;</span><br><span class="hljs-string">&quot;当且仅当五位数字其后紧跟着&quot;</span>-<span class="hljs-string">&quot;的时候，&quot;</span>-<span class="hljs-string">&quot;的后面才会有另外的四位数字&quot;</span><br><span class="hljs-string">&quot;因此，变化的因素仅仅是&quot;</span>-\d&#123;<span class="hljs-number">4</span>&#125;<span class="hljs-string">&quot;,或者说，只有在&quot;</span>-<span class="hljs-string">&quot;之前存在合法的内容时&quot;</span><br><span class="hljs-string">&quot;才会去匹配其后的内容&quot;</span><br></code></pre></td></tr></table></figure><p><strong>例一</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/16/UFrvkHYXPeiLwoM.png" alt="前后查找条件"></p><p><strong>思考(回溯引用条件与前后查找条件的特点)</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;1,回溯引用条件更适合去判断更为具体的内容对文本的影响，因为其自身的表达式就是具体的匹配字句&quot;</span><br><span class="hljs-string">&quot;2,而前后查找条件更适合去判断某几个特殊字符的位置，以及存在与否对整个文本内容的影响&quot;</span><br></code></pre></td></tr></table></figure><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">前后查找条件只在一个向前查找或向后查找操作取得成功的情况下才允<br>许一个表达式被使用。定义一个前后查找条件的语法与定义一个回溯引<br>用条件的语法大同小异——只需把回溯引用（括号里的回溯引用编号）<br>替换为一个完整的前后查找表达式就行了<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式_语法学习_9(前后查找)</title>
      <link href="/2022/04/14/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_9(%E5%89%8D%E5%90%8E%E6%9F%A5%E6%89%BE)/"/>
      <url>/2022/04/14/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_9(%E5%89%8D%E5%90%8E%E6%9F%A5%E6%89%BE)/</url>
      
        <content type="html"><![CDATA[<p><strong>一</strong>、<strong>向前查找</strong></p><p><strong>概述</strong>：<strong>向前查找就是指定了一个必须匹配但不在结果中返回的模式</strong></p><p><strong>语法形式</strong>：<strong>其实就是一个以</strong><code>?=</code> <strong>开头的子表达式，需要被匹配的文本跟在&quot;?&quot;之后</strong></p><p><strong>提示</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">提示 有些正则表达式文档使用术语“消费”（consume）来表述“匹配<br>和返回文本”的含义。在向前查找里，被匹配的文本不包含在最终返<br>回的匹配结果里，这被称为“不消费”。<br></code></pre></td></tr></table></figure><p><strong>例子</strong>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/15/6EozZUQ1bnW2i5M.png" alt="向前查找"></p><p><strong>分析</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-string">&quot;.+&quot;</span>匹配至少一个字符，这对应着URL的协议名，显然我们也只需要协议名，<br>并不需要再往后的内容，也是说说我们只要消费协议名，因此<br>我们就可以使用向前查找，<span class="hljs-string">&quot;?=:&quot;</span>匹配到<span class="hljs-string">&quot;:&quot;</span>，但是<br>并不消费<span class="hljs-string">&quot;:&quot;</span>，也就是不会返回匹配到的结果，<br></code></pre></td></tr></table></figure><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">向前查找（和先后查找）匹配其实本身是有返回结果的，<br>只不过，<br>这个结果的返回长度永远是<span class="hljs-number">0</span>而已，<br>因此，前后查找模式有时也被叫做，<br>零宽度（zero-width）匹配操作<br></code></pre></td></tr></table></figure><p><strong>二</strong>、<strong>向后查找</strong></p><p><strong>语法</strong>： <code>(?&lt;=)</code></p><p><strong>例子</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/15/4zih6n78sWuaSOy.png" alt="向后查找"></p><p><strong>向前查找和向后查找的结合</strong></p><p><strong>直接上例子</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/15/a1WvcZGqJXBKM4r.png" alt="向前查找和向后查找的结合"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">问题解决了。(?&lt;=&lt;[tT][iI][tT][lL][eE]&gt;)是一个向后查找操作，<br>它匹配（但不消费）&lt;TITLE&gt;；而(?=&lt;/[tT][iI][tT][lL][eE]&gt;)是<br>一个向前查找操作，它匹配（但不消费）&lt;/TITLE&gt;。最终返回的匹配<br>结果包含且仅包含标题文字（用术语来说，就是只有标题文字被消费<br>了）。<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式_语法学习_7(使用子表达式-回溯引用)</title>
      <link href="/2022/04/13/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_7(%E4%BD%BF%E7%94%A8%E5%AD%90%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%9B%9E%E6%BA%AF%E5%BC%95%E7%94%A8)/"/>
      <url>/2022/04/13/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_7(%E4%BD%BF%E7%94%A8%E5%AD%90%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%9B%9E%E6%BA%AF%E5%BC%95%E7%94%A8)/</url>
      
        <content type="html"><![CDATA[<p><strong>一、</strong> <strong>回溯引用匹配</strong></p><p><strong>功能</strong>：<code>\n</code>  <strong>即代表着第n个子表达式所匹配的内容</strong></p><p><strong>例一</strong>：</p><p><strong>目的</strong>：**匹配出HTML中成对出现的标题标签（<H1>到<H6>，以及配对的                                        如下图</H6></H1></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/15/LgetudVsD5olpFE.png" alt="\1"></p><p><strong>分析</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">第一个字句：<span class="hljs-string">&quot;([1-9])&quot;</span>匹配的是这一组标题标签的数字部分，而最后的<br><span class="hljs-string">&quot;\1&quot;</span>正代表着相同的数字内容，所以只有第一个（即第二行被成功匹配）<br>其余两对标签则因为开始和结束标签中的数字不相等而不被匹配<br>由此可以看出，<br>回溯引用指的是模式的后半部分去引用在前半部分中定义的子表达式<br></code></pre></td></tr></table></figure><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">回溯引用匹配通常从<span class="hljs-number">1</span>开始计数（\<span class="hljs-number">1</span>、\<span class="hljs-number">2</span>，等等）。在许多实<br>现里，第<span class="hljs-number">0</span>个匹配（\<span class="hljs-number">0</span>）可以用来代表整个正则表达式。<br></code></pre></td></tr></table></figure><p><strong>二</strong>：<strong>回溯引用在替换操作上的应用</strong></p><p><strong>目的</strong>：<strong>将文本中的邮件地址更改为可点击链接</strong></p><p><strong>使用</strong>：<code>$n</code></p><br><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/15/nG8RF7gwqfAQJcU.png" alt="$1"></p><p><strong>分析</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">第一个子表达式匹配出了一个电子邮箱地址，<br>$<span class="hljs-number">1</span>便代表着那第一个子表达式匹配出的内容<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式_语法学习_6（位置匹配）</title>
      <link href="/2022/04/12/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_6%EF%BC%88%E4%BD%8D%E7%BD%AE%E5%8C%B9%E9%85%8D%EF%BC%89/"/>
      <url>/2022/04/12/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_6%EF%BC%88%E4%BD%8D%E7%BD%AE%E5%8C%B9%E9%85%8D%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p><strong>一</strong>、<strong>单词边界</strong></p><p><strong>目的</strong>：** 匹配单个单词**</p><p><strong>使用元字符</strong>：<code>\b</code></p><p><strong>作用</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">\b到底匹配什么东西呢？正则表达式引擎不懂英语（事实<br>上，它不懂任何人类语言），也不知道什么是单词边界。简单地<br>说，\b匹配的是一个这样的位置，这个位置位于一个能够用来构成单<br>词的字符（字母、数字和下划线，也就是与\w相匹配的字符）和一个<br>不能用来构成单词的字符（也就是与\W相匹配的字符）之间。<br></code></pre></td></tr></table></figure><p><strong>例一</strong></p><p><strong>没有使用</strong>：<code>\b</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/14/OISMCdmZxwn3PEl.png" alt="没有使用\b"></p><p><strong>使用之后</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/14/ICVM8cjKEvz4tFu.png" alt="使用了\b"></p><p><strong>二、字符串边界</strong></p><p><strong>目的</strong>：<strong>对所要匹配的字符串（在一行的）的开头和（一行的）结尾做出限制</strong></p><p><strong>使用元字符</strong>：<code>^</code>  和<code>$</code></p><p><strong>直接上例子</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/14/a6dlBJMNsEDKPOX.png" alt="没有使用^or$并且没有加&quot;?&quot;"></p><br><p><strong>仔细分析</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">首先，<span class="hljs-string">&quot;&lt;&quot;</span>匹配第一个字符，随便后的转移之后的<span class="hljs-string">&quot;?&quot;</span>匹配第二个字符，xml类似，<br>重点：<br><span class="hljs-string">&quot;.*&quot;</span>将匹配零个或者多个字符，而这里注意，<span class="hljs-string">&quot;.&quot;</span>是一个贪婪行字符，<br>如果其后不加<span class="hljs-string">&quot;?&quot;</span>进行修饰为<span class="hljs-string">&quot;懒惰型字符&quot;</span>,那么会出现意想不到的后果，<br>                          上图中<br>这绝不是我们想要的结果，下图中的第三行<span class="hljs-string">&quot;看似没有问题&quot;</span>，<br>如若自己看就会发现，<br><span class="hljs-number">1.</span>在这一行最后的<span class="hljs-string">&quot;   and?&gt;&quot;</span>竟然也被匹配了进去！！<br><span class="hljs-number">2.</span>类似的错误同样出现在倒数第三行。<br><br>这就印证了<span class="hljs-string">&quot;.&quot;</span>这一贪婪型字符它饕餮般的行径（<br>注意：此处正对应着第五章最后一部分的小知识）<br><br>如何解决？加上<span class="hljs-string">&quot;?&quot;</span>!<br></code></pre></td></tr></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/14/ilr5uMFa2bCoXe4.png" alt="加上了&quot;?&quot;"></p><p><strong>但是</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">问题并没有得到完美解决，尽管我们匹配出了所有的目标，<br>但是我们还要求所匹配的字段是： 在一行的开头<br>也就是说第三、五、六个匹配是本不该被匹配的<br>即：我们要对模式字符串的一行开头做出限制<br></code></pre></td></tr></table></figure><p><strong>而这正是&quot;^&quot;元字符大显身手的时候</strong></p><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">还记得吗？我们在第<span class="hljs-number">3</span>章里已经见识过元字符^了，但那时的<br>它是一个用来对字符集合进行“求非”操作的元字符。那它还怎么用来<br>表明一个字符串的开头呢？<br>^是几个有着多种用途的元字符之一。只有当它出现在一个字符集合<br>里（被放在[和]之间）并紧跟在左方括号[的后面时，它才能发挥“求<br>非”作用。如果是在一个字符集合的外面并位于一个模式的开头，^将<br>匹配字符串的开头。<br></code></pre></td></tr></table></figure><p><strong>加上&quot;^&quot;后效果如下图</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/14/UvqrNjgGa4teT2P.png" alt="加上&quot;^&quot;"></p><p><strong>注意</strong>：</p><p><strong>这里通常写成</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">^\s*xml\?.*?\?&gt;<br></code></pre></td></tr></table></figure><p><strong>类似的元字符&quot;$&quot;用来修饰字符串的末尾处</strong></p><p><strong>目的</strong>： <strong>标签的后面不应该再有任何实际内容</strong></p><p><strong>例子</strong>：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/14/L32WB5FjqthrINV.png" alt="使用&quot;$&quot;"></p><br><p><strong>小结</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">正则表达式不仅可以用来匹配任意长度的文本块，还可以用来匹配出现<br>在字符串中特定位置的文本。\b用来指定一个单词边界（\B刚好相<br>反）。^和$用来指定字符串边界（字符串的开头和字符串的结束）。<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式_语法学习_5</title>
      <link href="/2022/04/11/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_5-/"/>
      <url>/2022/04/11/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_5-/</url>
      
        <content type="html"><![CDATA[<h1 id="有多少个匹配"><a class="markdownIt-Anchor" href="#有多少个匹配"></a> 有多少个匹配</h1><p><strong>一</strong>  、<strong>匹配一个或者多个字符</strong></p><p><strong>例一</strong></p><p><strong>目的</strong> ：匹配文本中的邮箱地址</p><p>**使用元字符<code>+</code> **</p><p><strong>用法</strong> ：</p><p>在字符或者字符集后面简单的加上一个“+“，则可匹配 <strong>至少一个</strong>符合该字符模式的字符</p><p>正则表达式 ：<code>[\w.]+@[\w.]+\.\w+</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/lcUiBe5tfsrD2dY.png" alt="使用元字符+"></p><p><strong>注意</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">注意 细心的读者可能已经注意到了：我们没有对字符集合[\w.]里<br>的.字符进行转义。尽管如此，它还是把原始文本里的.字符匹配出来<br>了。一般来说，当在字符集合里使用的时候，像.和+这样的元字符将<br>被解释为普通字符，不需要被转义——但转义了也没有坏处。[\w.]<br>的使用效果与[\w\ .]是一样的。<br></code></pre></td></tr></table></figure><p><strong>二</strong> 、 <strong>匹配零个或者多个字符</strong></p><p><strong>例二</strong></p><p><strong>目的</strong> ：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">匹配出合法的邮箱地址（邮箱地址开头不能以`.` 开头，<br>所以我们的正则表达式需要 可以去匹配出第一个字母或数字，<br>同时”@“前面也可以只有那**一个**合法字符，而不需要再出现 多个字母数字，<br>也就是**第一个**合法字符之后的 **字符**是可（**多**）有可**无**的）<br><br></code></pre></td></tr></table></figure><p><strong>使用元字符</strong>:<code>*</code></p><p><strong>用法与<code>+</code>一致</strong></p><p><strong>正则表达式</strong>： <code>\w[\w.]*@[\w.]+\.[\w]+</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/q9cBiXYts6GhTdP.png" alt="使用元字符*"></p><br><p><strong>三</strong> ： <strong>匹配零个或者一个字符</strong></p><p><strong>目的</strong> ： <strong>匹配https或者http</strong></p><p><strong>使用元字符</strong>： <code>?</code></p><p><code>?</code>将匹配<strong>一个或零个字符</strong>或者<strong>字符集一次或零次</strong></p><br><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/ebfvxatJgZo6SY8.png" alt="使用元字符？"></p><p><strong>例三</strong></p><p><strong>目的</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">仔细体会?与+和*的相似和区别<br>之处。如果需要在一段文本里匹配某个特定的字符（或字符集合）而该<br>字符可能出现、也可能不出现，?无疑是最佳的选择。<br></code></pre></td></tr></table></figure><p><strong>例四</strong> ：<strong>匹配指定次数</strong></p><p><strong>目的</strong> 匹配日期格式</p><p><strong>使用元字符</strong> ： <code>&#123;&#125;</code></p><p><strong>用法</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">&#123;&#125;里面天的数字为所指定的匹配次数<br>或者<br>数字区间&#123;x1，x2&#125;（即最少x1次，最多x2次）<br><br></code></pre></td></tr></table></figure><p><strong>正则表达式</strong>：<code>\d&#123;1,2&#125;[/-]\d&#123;1,2&#125;[-/]\d&#123;0,4&#125;</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/NwKBYpiEIhgulCv.png" alt="使用元字符{}"></p><br><br><p><strong>综合例五</strong></p><p><strong>目的</strong>： <strong>使用一个正则表达式把所有大于或等于$100美元的金额找出来</strong></p><p><strong>使用</strong>： <code>&#123;x,&#125;</code></p><p><strong>正则表达式</strong>： <code>\d+: \d&#123;3,&#125;\.\d&#123;2&#125;</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/VzWmNXpZDik2CUv.png" alt="使用{x,}"></p><br><p><strong>例六</strong></p><p><strong>目的</strong>：<strong>防止过度匹配</strong></p><p><strong>参考表格</strong></p><table><thead><tr><th>贪婪型元字符</th><th>懒惰型元字符</th></tr></thead><tbody><tr><td>*</td><td>*？</td></tr><tr><td>+</td><td>+？</td></tr><tr><td>{n,}</td><td>{n,}?</td></tr></tbody></table><p><strong>贪婪的例子</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/BY4AC2kn6W8HLQf.png" alt="贪婪的例子"></p><p><strong>分析</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;[Bb]&gt;匹配&lt;B&gt;标签（大小写均可），&lt;/[Bb]&gt;匹配&lt;/B&gt;标签（也是大<br>小写均可）。但这个模式只找到了一个匹配而不是预期中的两个：第一<br>个&lt;B&gt;标签之后、最后一个&lt;/B&gt;标签之前的所有东西——AK&lt;/B&gt; and<br>&lt;B&gt;HI——被.*一网打尽。虽然没有漏掉我们想要匹配的文本，但问题<br>是第<span class="hljs-number">2</span>个&lt;B&gt;标签不明不白地“失踪”了。<br>为什么会这样？因为*和+都是所谓的“贪婪型”元字符，它们在进行匹配<br>时的行为模式是多多益善而不是适可而止的。它们会尽可能地从一段文<br>本的开头一直匹配到这段文本的末尾，而不是从这段文本的开头匹配到<br>碰到第一个匹配时为止。<br></code></pre></td></tr></table></figure><p><strong>懒惰版改进（加上”？“）</strong></p><br><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/12/byNMS6sLkY4gJhp.png" alt="懒惰版改进（加上”？“）"></p><br><h2 id="小结"><a class="markdownIt-Anchor" href="#小结"></a> 小结</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">正则表达式的真正威力体现在重复次数匹配方面。本章介绍了+（匹配<br>字符或字符集合的一次或多次重复出现）、*（匹配字符或字符集合的<br>零次或多次重复出现）、?（匹配字符或字符集合的零次或一次出现）<br>等几个元字符的用法。要想获得更精确的控制，你可以用&#123; &#125;语法来精<br>确地设定一个重复次数或是重复次数的最小值和最大值。元字符分“贪<br>婪型”和“懒惰型”两种；在需要防止过度匹配的场合下，请使用“懒惰<br>型”元字符来构造你的正则表达式.<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式_语法学习__2至4</title>
      <link href="/2022/04/09/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_2%E8%87%B34/"/>
      <url>/2022/04/09/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_learn/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F_%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0_2%E8%87%B34/</url>
      
        <content type="html"><![CDATA[<h1 id="匹配任意字符的"><a class="markdownIt-Anchor" href="#匹配任意字符的"></a> 匹配任意字符的 “.”</h1><p><strong>注意</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">1.&quot;matches any character (expect for line terminators)&quot;<br><span class="hljs-code">         (&quot;.&quot;可以匹配除了换行符的任意字符)</span><br><span class="hljs-code">        2.当要匹配诸如&quot;.&quot;这样的特殊字符时，要用&quot;\&quot;来转义</span><br><span class="hljs-code">         如若要匹配&quot;.&quot;</span><br></code></pre></td></tr></table></figure><p><code>则要使用 \.</code></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/10/cY7hyWxE4oGb2jm.png" alt="特殊字符转义"></p><h2 id="匹配一组字符"><a class="markdownIt-Anchor" href="#匹配一组字符"></a> 匹配一组字符</h2><p><strong>用法</strong> 使用字符集合&quot;[]&quot;</p><p><strong>例一</strong></p><p>第一个像被匹配的字符只能是n或者s</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/10/MPoIZ5lmAc2J4hF.png" alt></p><p><strong>例二</strong></p><p>区间字符</p><p>A-Z</p><p><code>[A-Z]</code></p><p>A-Z 并且 0-9</p><br><p><code>[A-Z0-9]</code></p><br><p><strong>例三</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">取非操作<br>要匹配任意的非字母数字字符<br>则可以<br></code></pre></td></tr></table></figure><p><code>[^A-Za-z0-9]</code></p><br><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/10/k17uFwoVx9EZd8I.png" alt="取非操作"></p><p><strong>注意</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">^的效果将作用于给定字符集合里的所有字符或字符区间，而<br>不是仅限于紧跟在^字符后面的那一个字符或字符区间<br></code></pre></td></tr></table></figure><p><strong>小结</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">元字符[和]用来定义一个字符集合，其含义是必须匹配该集合里的字符<br>之一。定义一个字符集合的具体做法有两种：一是把所有的字符都列举<br>出来；二是利用元字符-以字符区间的方式给出。字符集合可以用元字<br>符^来求非；这将把给定的字符集合强行排除在匹配操作以外——除了<br>该字符集合里的字符，其他字符都可以被匹配。<br></code></pre></td></tr></table></figure><br><h3 id="使用元字符"><a class="markdownIt-Anchor" href="#使用元字符"></a> 使用元字符</h3><p>** 例一**</p><p><strong>对特殊字符进行转义</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">提示 任何一个元字符都可以通过给它加上一个反斜杠字符（\）作<br>为前缀的办法来转义，能够被转义的元字符并不仅局限于我们这里提<br>到的那几个。<br>警告 配对的元字符（比如[或]）不用作元字符时必须被转义，否则<br>正则表达式分析器很可能会抛出一个错误。<br></code></pre></td></tr></table></figure><p><strong>注意</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">如果你在这个正则表达式里只写出了一个\的话<br>你应该会看到一条出错消息。<br>这是因为正则表达式分析器会认为你的正则表达式不完整，<br>在一个完整的正则表达式里，字符\的后面永远跟着另一个字符。<br><br></code></pre></td></tr></table></figure><p><strong>例二</strong></p><p><strong>匹配空白字符</strong></p><table><thead><tr><th>元字符</th><th>说明</th></tr></thead><tbody><tr><td>[\b]</td><td>回退（并删除）一个字符</td></tr><tr><td>\f</td><td>换页符</td></tr><tr><td>\n</td><td>换行符</td></tr><tr><td>\r</td><td>回车符</td></tr><tr><td>\t</td><td>制表符</td></tr><tr><td>\v</td><td>垂直制表符</td></tr></tbody></table><p><strong>注意（一个有意思的现象）</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">你已经见过不少元字符了，但你注意到它们之间的差异了<br>吗？.和[是元字符，但前提是你没有对它们进行转义。f和n也是元字<br>符，但前提是你对它们进行了转义。如果你没有对f和n进行转义，它<br>们将被解释为普通字符，只能匹配它们本身。<br></code></pre></td></tr></table></figure><br><p><strong>例三</strong></p><p><strong>使用数字元字符</strong></p><table><thead><tr><th>元字符</th><th>说明</th></tr></thead><tbody><tr><td>\d</td><td>任何一个数字字符（等价于[0-9]</td></tr><tr><td>\D</td><td>任何一个非数字字符（等价于[^0-9]</td></tr></tbody></table><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/10/I5yJbBTuH9AjLzW.png" alt="使用数字元字符"></p><p><strong>使用数字字母元字符</strong></p><table><thead><tr><th>元字符</th><th>说明</th></tr></thead><tbody><tr><td>\w</td><td>任何一个字母数字（大小写均可）或下划线字符 等价于[0-9a-zA-Z_]</td></tr><tr><td>\W</td><td>任何一个非数字字母和下划线 等价于[0-9a-zA-Z_]</td></tr></tbody></table><p><strong>样例</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/04/10/sq9bjuwDTL8WO5c.png" alt="使用数字字母元字符"></p><p><strong>注意</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"> 在上面这个例子里，我们使用的正则表达式解决了我们的问<br>题。但它正确吗？请大家思考一下，为什么美国的邮政编码没有被匹<br>配出来？是因为它们只由数字构成、还是因为什么其他原因？<br>我们将不给出这个问题的答案，理由很简单——例子里的模式解决了<br>问题。这里的关键是正则表达式很少有对错之分（当然，前提是它们<br>能解决问题），我们更关心的是它们的复杂程度——而这要由模式匹<br>配操作的精确程度来决定；如果你需要更精确的匹配，就需要构造更<br>复杂的正则表达式。<br></code></pre></td></tr></table></figure><br><p><strong>例四</strong></p><p><strong>使用匹配空白字符的元字符</strong></p><br><table><thead><tr><th>元字符</th><th>说明</th></tr></thead><tbody><tr><td>\s</td><td>任何一个空字符（除了\b) 等价于[\f\t\n\v\r]</td></tr><tr><td>\S</td><td>任何一个非空字符 以及 \b 等价于[^\f\v\t\n\r]</td></tr></tbody></table><br><h3 id="使用posix字符类"><a class="markdownIt-Anchor" href="#使用posix字符类"></a> 使用POSIX字符类</h3><table><thead><tr><th>字符类</th><th>说明</th></tr></thead><tbody><tr><td>[:alnum:]</td><td>任何一个字母或数字 等价于 [0-9a-zA-Z] 注意千万不是等价于\w  !!</td></tr><tr><td>[:alpha:]</td><td>任何一个字母 等价于[a-zA-Z]</td></tr><tr><td>[:blank:]</td><td>空格或者制表符 等价于[\t ] 注意\t 后有一个空格</td></tr><tr><td>[:cntrl:]</td><td>ASCII控制字符（ASCII 0到31，再加上ASCII 127）</td></tr><tr><td>[:digit:]</td><td>[0-9]</td></tr><tr><td>[:print:]</td><td>任何一个可打印字符</td></tr><tr><td>[:graph:]</td><td>仅仅是[:print:]不包含空格的情况</td></tr><tr><td>[:lower:]</td><td>[a-z]</td></tr><tr><td>[:punct:]</td><td>既不属于[:alnum:]也不属于[:cntrl:]的任何一个字符</td></tr><tr><td>[:space:]</td><td>任何一个空白字符，包括空格</td></tr><tr><td>[:upper:]</td><td>任何一个大写字母（等价于[A-Z]）</td></tr><tr><td>[:xdigit:]</td><td>任何一个十六进制数字（等价于[a-fA-F0-9]）</td></tr></tbody></table><p><strong>注意</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"> 这里使用的模式以[[开头、以]]结束（两对方括号）。这是使<br>用POSIX字符类所必须的。POSIX字符类必须括在[:和:]之间，我们<br>使用的POSIX字符类是[:xdigit:]（不是:xdigit:）。外层的[和]<br>字符用来定义一个字符集合，内层的[和]字符是POSIX字符类本身的<br>组成部分。<br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> learn </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
